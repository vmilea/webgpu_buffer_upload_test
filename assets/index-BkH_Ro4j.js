var ci=Object.defineProperty;var Cs=e=>{throw TypeError(e)};var ui=(e,t,n)=>t in e?ci(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Sn=(e,t,n)=>ui(e,typeof t!="symbol"?t+"":t,n),Es=(e,t,n)=>t.has(e)||Cs("Cannot "+n);var zt=(e,t,n)=>(Es(e,t,"read from private field"),n?n.call(e):t.get(e)),vn=(e,t,n)=>t.has(e)?Cs("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Ms=(e,t,n,s)=>(Es(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const b of u.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&s(b)}).observe(document,{childList:!0,subtree:!0});function n(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(i){if(i.ep)return;i.ep=!0;const u=n(i);fetch(i.href,u)}})();function te(e,t){if(!e)throw new Error(t)}function ks(e){throw new Error(e)}class pi{constructor(t,n){Sn(this,"buffer");Sn(this,"mappingSize");console.log(`new StagingBuffer - size: ${n}`),this.buffer=t.createBuffer({label:"stagingBuffer",size:n,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),this.mappingSize=n}}var he,ge,ve;class ir{constructor(t,n,s){vn(this,he,new Array);vn(this,ge,new Set([]));vn(this,ve,!1);this.device=t,this.bufferSize=n,this.maxBuffers=s}next(){if(te(!zt(this,ve)),0<zt(this,he).length)return zt(this,he).shift();if(zt(this,ge).size<this.maxBuffers)return new pi(this.device,this.bufferSize)}remap(t,n){te(!zt(this,ve)),zt(this,ge).add(t),t.buffer.mapAsync(GPUMapMode.WRITE,0,n).then(()=>{zt(this,ge).delete(t),zt(this,ve)?t.buffer.destroy():(t.mappingSize=n,zt(this,he).push(t))},s=>{zt(this,ge).delete(t),console.error(`mapAsync() failed - ${s}`)})}destroy(){te(!zt(this,ve));for(const t of zt(this,he))t.buffer.destroy();zt(this,he).length=0,Ms(this,ve,!0)}}he=new WeakMap,ge=new WeakMap,ve=new WeakMap;const di=`struct SceneUniform {\r
    viewProjectionTransform: mat4x4f,\r
}\r
\r
@group(0) @binding(0) var<uniform> uScene: SceneUniform;\r
\r
struct VertexInput {\r
    @location(0) position: vec2f,\r
    @location(1) color: vec4f, // premultiplied\r
    @location(2) instanceTransformCol0: vec4f,\r
    @location(3) instanceTransformCol1: vec4f,\r
    @location(4) instanceTransformCol2: vec4f,\r
    @location(5) instanceTransformCol3: vec4f,\r
    @location(6) instanceColor: vec4f, // premultiplied\r
};\r
\r
struct VertexOutput {\r
    @builtin(position) position: vec4f,\r
    @location(0) color: vec4f, // premultiplied\r
}\r
\r
@vertex fn vertexMain(in: VertexInput) -> VertexOutput {\r
    let instanceTransform = mat4x4f(in.instanceTransformCol0,\r
                                    in.instanceTransformCol1,\r
                                    in.instanceTransformCol2,\r
                                    in.instanceTransformCol3);\r
    let position = uScene.viewProjectionTransform * (instanceTransform * vec4f(in.position, 0, 1));\r
    let color = in.color * in.instanceColor;\r
    return VertexOutput(position, color);\r
}\r
\r
@fragment fn fragmentMain(in: VertexOutput) -> @location(0) vec4f {\r
    return in.color;\r
}\r
`,hi=`struct SceneUniform {\r
    viewProjectionTransform: mat4x4f,\r
}\r
\r
struct Instance {\r
    transform : mat4x4f,\r
    color : vec4f, // premultiplied\r
}\r
\r
@group(0) @binding(0) var<uniform> uScene: SceneUniform;\r
@group(0) @binding(1) var<storage, read> gInstances: array<Instance>;\r
\r
struct VertexInput {\r
    @location(0) position: vec2f,\r
    @location(1) color: vec4f, // premultiplied\r
};\r
\r
struct VertexOutput {\r
    @builtin(position) position: vec4f,\r
    @location(0) color: vec4f, // premultiplied\r
}\r
\r
@vertex fn vertexMain(@builtin(instance_index) instanceIndex: u32, in: VertexInput) -> VertexOutput {\r
    let instance = gInstances[instanceIndex];\r
    let position = uScene.viewProjectionTransform * (instance.transform * vec4f(in.position, 0, 1));\r
    let color = in.color * instance.color;\r
    return VertexOutput(position, color);\r
}\r
\r
@fragment fn fragmentMain(in: VertexOutput) -> @location(0) vec4f {\r
    return in.color;\r
}\r
`,vi=`struct SceneUniform {
    viewProjectionTransform: mat4x4f,
}

struct Uniform {
    modelTransform: mat4x4f,
}

@group(0) @binding(0) var<uniform> uScene: SceneUniform;
@group(0) @binding(1) var<uniform> u: Uniform;

struct VertexInput {
    @location(0) position: vec2f,
    @location(1) color: vec4f, // premultiplied
};

struct VertexOutput {
    @builtin(position) position: vec4f,
    @location(0) color: vec4f, // premultiplied
}

@vertex fn vertexMain(in: VertexInput) -> VertexOutput {
    let position = uScene.viewProjectionTransform * (u.modelTransform * vec4f(in.position, 0, 1));
    return VertexOutput(position, in.color);
}

@fragment fn fragmentMain(in: VertexOutput) -> @location(0) vec4f {
    return in.color;
}
`;function fi(e,t,n,s){let u=0;for(;u<s;){const b=Math.min(s-u,4194304);e.writeBuffer(t,u,n,u,b),u+=b}}function mi(e,t){return Math.ceil(e/t)*t}function bi(e,t){return class extends e{constructor(...n){super(...n),t(this)}}}const wi=bi(Array,e=>e.fill(0));let W=1e-6;function _i(e){function t(r=0,c=0){const o=new e(2);return r!==void 0&&(o[0]=r,c!==void 0&&(o[1]=c)),o}const n=t;function s(r,c,o){const a=o??new e(2);return a[0]=r,a[1]=c,a}function i(r,c){const o=c??new e(2);return o[0]=Math.ceil(r[0]),o[1]=Math.ceil(r[1]),o}function u(r,c){const o=c??new e(2);return o[0]=Math.floor(r[0]),o[1]=Math.floor(r[1]),o}function b(r,c){const o=c??new e(2);return o[0]=Math.round(r[0]),o[1]=Math.round(r[1]),o}function C(r,c=0,o=1,a){const v=a??new e(2);return v[0]=Math.min(o,Math.max(c,r[0])),v[1]=Math.min(o,Math.max(c,r[1])),v}function O(r,c,o){const a=o??new e(2);return a[0]=r[0]+c[0],a[1]=r[1]+c[1],a}function T(r,c,o,a){const v=a??new e(2);return v[0]=r[0]+c[0]*o,v[1]=r[1]+c[1]*o,v}function N(r,c){const o=r[0],a=r[1],v=c[0],x=c[1],k=Math.sqrt(o*o+a*a),l=Math.sqrt(v*v+x*x),h=k*l,w=h&&Ft(r,c)/h;return Math.acos(w)}function L(r,c,o){const a=o??new e(2);return a[0]=r[0]-c[0],a[1]=r[1]-c[1],a}const j=L;function rt(r,c){return Math.abs(r[0]-c[0])<W&&Math.abs(r[1]-c[1])<W}function K(r,c){return r[0]===c[0]&&r[1]===c[1]}function H(r,c,o,a){const v=a??new e(2);return v[0]=r[0]+o*(c[0]-r[0]),v[1]=r[1]+o*(c[1]-r[1]),v}function ct(r,c,o,a){const v=a??new e(2);return v[0]=r[0]+o[0]*(c[0]-r[0]),v[1]=r[1]+o[1]*(c[1]-r[1]),v}function _t(r,c,o){const a=o??new e(2);return a[0]=Math.max(r[0],c[0]),a[1]=Math.max(r[1],c[1]),a}function Tt(r,c,o){const a=o??new e(2);return a[0]=Math.min(r[0],c[0]),a[1]=Math.min(r[1],c[1]),a}function St(r,c,o){const a=o??new e(2);return a[0]=r[0]*c,a[1]=r[1]*c,a}const Qt=St;function jt(r,c,o){const a=o??new e(2);return a[0]=r[0]/c,a[1]=r[1]/c,a}function qt(r,c){const o=c??new e(2);return o[0]=1/r[0],o[1]=1/r[1],o}const Yt=qt;function Nt(r,c,o){const a=o??new e(3),v=r[0]*c[1]-r[1]*c[0];return a[0]=0,a[1]=0,a[2]=v,a}function Ft(r,c){return r[0]*c[0]+r[1]*c[1]}function gt(r){const c=r[0],o=r[1];return Math.sqrt(c*c+o*o)}const Jt=gt;function nt(r){const c=r[0],o=r[1];return c*c+o*o}const lt=nt;function J(r,c){const o=r[0]-c[0],a=r[1]-c[1];return Math.sqrt(o*o+a*a)}const m=J;function A(r,c){const o=r[0]-c[0],a=r[1]-c[1];return o*o+a*a}const P=A;function V(r,c){const o=c??new e(2),a=r[0],v=r[1],x=Math.sqrt(a*a+v*v);return x>1e-5?(o[0]=a/x,o[1]=v/x):(o[0]=0,o[1]=0),o}function q(r,c){const o=c??new e(2);return o[0]=-r[0],o[1]=-r[1],o}function z(r,c){const o=c??new e(2);return o[0]=r[0],o[1]=r[1],o}const Y=z;function X(r,c,o){const a=o??new e(2);return a[0]=r[0]*c[0],a[1]=r[1]*c[1],a}const tt=X;function U(r,c,o){const a=o??new e(2);return a[0]=r[0]/c[0],a[1]=r[1]/c[1],a}const $=U;function st(r=1,c){const o=c??new e(2),a=Math.random()*2*Math.PI;return o[0]=Math.cos(a)*r,o[1]=Math.sin(a)*r,o}function y(r){const c=r??new e(2);return c[0]=0,c[1]=0,c}function D(r,c,o){const a=o??new e(2),v=r[0],x=r[1];return a[0]=v*c[0]+x*c[4]+c[12],a[1]=v*c[1]+x*c[5]+c[13],a}function p(r,c,o){const a=o??new e(2),v=r[0],x=r[1];return a[0]=c[0]*v+c[4]*x+c[8],a[1]=c[1]*v+c[5]*x+c[9],a}function d(r,c,o,a){const v=a??new e(2),x=r[0]-c[0],k=r[1]-c[1],l=Math.sin(o),h=Math.cos(o);return v[0]=x*h-k*l+c[0],v[1]=x*l+k*h+c[1],v}function f(r,c,o){const a=o??new e(2);return V(r,a),St(a,c,a)}function g(r,c,o){const a=o??new e(2);return gt(r)>c?f(r,c,a):z(r,a)}function B(r,c,o){const a=o??new e(2);return H(r,c,.5,a)}return{create:t,fromValues:n,set:s,ceil:i,floor:u,round:b,clamp:C,add:O,addScaled:T,angle:N,subtract:L,sub:j,equalsApproximately:rt,equals:K,lerp:H,lerpV:ct,max:_t,min:Tt,mulScalar:St,scale:Qt,divScalar:jt,inverse:qt,invert:Yt,cross:Nt,dot:Ft,length:gt,len:Jt,lengthSq:nt,lenSq:lt,distance:J,dist:m,distanceSq:A,distSq:P,normalize:V,negate:q,copy:z,clone:Y,multiply:X,mul:tt,divide:U,div:$,random:st,zero:y,transformMat4:D,transformMat3:p,rotate:d,setLength:f,truncate:g,midpoint:B}}const Ss=new Map;function or(e){let t=Ss.get(e);return t||(t=_i(e),Ss.set(e,t)),t}function gi(e){const t=or(e);function n(m,A,P,V,q,z,Y,X,tt){const U=new e(12);return U[3]=0,U[7]=0,U[11]=0,m!==void 0&&(U[0]=m,A!==void 0&&(U[1]=A,P!==void 0&&(U[2]=P,V!==void 0&&(U[4]=V,q!==void 0&&(U[5]=q,z!==void 0&&(U[6]=z,Y!==void 0&&(U[8]=Y,X!==void 0&&(U[9]=X,tt!==void 0&&(U[10]=tt))))))))),U}function s(m,A,P,V,q,z,Y,X,tt,U){const $=U??new e(12);return $[0]=m,$[1]=A,$[2]=P,$[3]=0,$[4]=V,$[5]=q,$[6]=z,$[7]=0,$[8]=Y,$[9]=X,$[10]=tt,$[11]=0,$}function i(m,A){const P=A??new e(12);return P[0]=m[0],P[1]=m[1],P[2]=m[2],P[3]=0,P[4]=m[4],P[5]=m[5],P[6]=m[6],P[7]=0,P[8]=m[8],P[9]=m[9],P[10]=m[10],P[11]=0,P}function u(m,A){const P=A??new e(12),V=m[0],q=m[1],z=m[2],Y=m[3],X=V+V,tt=q+q,U=z+z,$=V*X,st=q*X,y=q*tt,D=z*X,p=z*tt,d=z*U,f=Y*X,g=Y*tt,B=Y*U;return P[0]=1-y-d,P[1]=st+B,P[2]=D-g,P[3]=0,P[4]=st-B,P[5]=1-$-d,P[6]=p+f,P[7]=0,P[8]=D+g,P[9]=p-f,P[10]=1-$-y,P[11]=0,P}function b(m,A){const P=A??new e(12);return P[0]=-m[0],P[1]=-m[1],P[2]=-m[2],P[4]=-m[4],P[5]=-m[5],P[6]=-m[6],P[8]=-m[8],P[9]=-m[9],P[10]=-m[10],P}function C(m,A){const P=A??new e(12);return P[0]=m[0],P[1]=m[1],P[2]=m[2],P[4]=m[4],P[5]=m[5],P[6]=m[6],P[8]=m[8],P[9]=m[9],P[10]=m[10],P}const O=C;function T(m,A){return Math.abs(m[0]-A[0])<W&&Math.abs(m[1]-A[1])<W&&Math.abs(m[2]-A[2])<W&&Math.abs(m[4]-A[4])<W&&Math.abs(m[5]-A[5])<W&&Math.abs(m[6]-A[6])<W&&Math.abs(m[8]-A[8])<W&&Math.abs(m[9]-A[9])<W&&Math.abs(m[10]-A[10])<W}function N(m,A){return m[0]===A[0]&&m[1]===A[1]&&m[2]===A[2]&&m[4]===A[4]&&m[5]===A[5]&&m[6]===A[6]&&m[8]===A[8]&&m[9]===A[9]&&m[10]===A[10]}function L(m){const A=m??new e(12);return A[0]=1,A[1]=0,A[2]=0,A[4]=0,A[5]=1,A[6]=0,A[8]=0,A[9]=0,A[10]=1,A}function j(m,A){const P=A??new e(12);if(P===m){let y;return y=m[1],m[1]=m[4],m[4]=y,y=m[2],m[2]=m[8],m[8]=y,y=m[6],m[6]=m[9],m[9]=y,P}const V=m[0*4+0],q=m[0*4+1],z=m[0*4+2],Y=m[1*4+0],X=m[1*4+1],tt=m[1*4+2],U=m[2*4+0],$=m[2*4+1],st=m[2*4+2];return P[0]=V,P[1]=Y,P[2]=U,P[4]=q,P[5]=X,P[6]=$,P[8]=z,P[9]=tt,P[10]=st,P}function rt(m,A){const P=A??new e(12),V=m[0*4+0],q=m[0*4+1],z=m[0*4+2],Y=m[1*4+0],X=m[1*4+1],tt=m[1*4+2],U=m[2*4+0],$=m[2*4+1],st=m[2*4+2],y=st*X-tt*$,D=-st*Y+tt*U,p=$*Y-X*U,d=1/(V*y+q*D+z*p);return P[0]=y*d,P[1]=(-st*q+z*$)*d,P[2]=(tt*q-z*X)*d,P[4]=D*d,P[5]=(st*V-z*U)*d,P[6]=(-tt*V+z*Y)*d,P[8]=p*d,P[9]=(-$*V+q*U)*d,P[10]=(X*V-q*Y)*d,P}function K(m){const A=m[0],P=m[0*4+1],V=m[0*4+2],q=m[1*4+0],z=m[1*4+1],Y=m[1*4+2],X=m[2*4+0],tt=m[2*4+1],U=m[2*4+2];return A*(z*U-tt*Y)-q*(P*U-tt*V)+X*(P*Y-z*V)}const H=rt;function ct(m,A,P){const V=P??new e(12),q=m[0],z=m[1],Y=m[2],X=m[4],tt=m[5],U=m[6],$=m[8],st=m[9],y=m[10],D=A[0],p=A[1],d=A[2],f=A[4],g=A[5],B=A[6],r=A[8],c=A[9],o=A[10];return V[0]=q*D+X*p+$*d,V[1]=z*D+tt*p+st*d,V[2]=Y*D+U*p+y*d,V[4]=q*f+X*g+$*B,V[5]=z*f+tt*g+st*B,V[6]=Y*f+U*g+y*B,V[8]=q*r+X*c+$*o,V[9]=z*r+tt*c+st*o,V[10]=Y*r+U*c+y*o,V}const _t=ct;function Tt(m,A,P){const V=P??L();return m!==V&&(V[0]=m[0],V[1]=m[1],V[2]=m[2],V[4]=m[4],V[5]=m[5],V[6]=m[6]),V[8]=A[0],V[9]=A[1],V[10]=1,V}function St(m,A){const P=A??t.create();return P[0]=m[8],P[1]=m[9],P}function Qt(m,A,P){const V=P??t.create(),q=A*4;return V[0]=m[q+0],V[1]=m[q+1],V}function jt(m,A,P,V){const q=V===m?m:C(m,V),z=P*4;return q[z+0]=A[0],q[z+1]=A[1],q}function qt(m,A){const P=A??t.create(),V=m[0],q=m[1],z=m[4],Y=m[5];return P[0]=Math.sqrt(V*V+q*q),P[1]=Math.sqrt(z*z+Y*Y),P}function Yt(m,A){const P=A??new e(12);return P[0]=1,P[1]=0,P[2]=0,P[4]=0,P[5]=1,P[6]=0,P[8]=m[0],P[9]=m[1],P[10]=1,P}function Nt(m,A,P){const V=P??new e(12),q=A[0],z=A[1],Y=m[0],X=m[1],tt=m[2],U=m[1*4+0],$=m[1*4+1],st=m[1*4+2],y=m[2*4+0],D=m[2*4+1],p=m[2*4+2];return m!==V&&(V[0]=Y,V[1]=X,V[2]=tt,V[4]=U,V[5]=$,V[6]=st),V[8]=Y*q+U*z+y,V[9]=X*q+$*z+D,V[10]=tt*q+st*z+p,V}function Ft(m,A){const P=A??new e(12),V=Math.cos(m),q=Math.sin(m);return P[0]=V,P[1]=q,P[2]=0,P[4]=-q,P[5]=V,P[6]=0,P[8]=0,P[9]=0,P[10]=1,P}function gt(m,A,P){const V=P??new e(12),q=m[0*4+0],z=m[0*4+1],Y=m[0*4+2],X=m[1*4+0],tt=m[1*4+1],U=m[1*4+2],$=Math.cos(A),st=Math.sin(A);return V[0]=$*q+st*X,V[1]=$*z+st*tt,V[2]=$*Y+st*U,V[4]=$*X-st*q,V[5]=$*tt-st*z,V[6]=$*U-st*Y,m!==V&&(V[8]=m[8],V[9]=m[9],V[10]=m[10]),V}function Jt(m,A){const P=A??new e(12);return P[0]=m[0],P[1]=0,P[2]=0,P[4]=0,P[5]=m[1],P[6]=0,P[8]=0,P[9]=0,P[10]=1,P}function nt(m,A,P){const V=P??new e(12),q=A[0],z=A[1];return V[0]=q*m[0*4+0],V[1]=q*m[0*4+1],V[2]=q*m[0*4+2],V[4]=z*m[1*4+0],V[5]=z*m[1*4+1],V[6]=z*m[1*4+2],m!==V&&(V[8]=m[8],V[9]=m[9],V[10]=m[10]),V}function lt(m,A){const P=A??new e(12);return P[0]=m,P[1]=0,P[2]=0,P[4]=0,P[5]=m,P[6]=0,P[8]=0,P[9]=0,P[10]=1,P}function J(m,A,P){const V=P??new e(12);return V[0]=A*m[0*4+0],V[1]=A*m[0*4+1],V[2]=A*m[0*4+2],V[4]=A*m[1*4+0],V[5]=A*m[1*4+1],V[6]=A*m[1*4+2],m!==V&&(V[8]=m[8],V[9]=m[9],V[10]=m[10]),V}return{clone:O,create:n,set:s,fromMat4:i,fromQuat:u,negate:b,copy:C,equalsApproximately:T,equals:N,identity:L,transpose:j,inverse:rt,invert:H,determinant:K,mul:_t,multiply:ct,setTranslation:Tt,getTranslation:St,getAxis:Qt,setAxis:jt,getScaling:qt,translation:Yt,translate:Nt,rotation:Ft,rotate:gt,scaling:Jt,scale:nt,uniformScaling:lt,uniformScale:J}}const Vs=new Map;function xi(e){let t=Vs.get(e);return t||(t=gi(e),Vs.set(e,t)),t}function yi(e){function t(l,h,w){const _=new e(3);return l!==void 0&&(_[0]=l,h!==void 0&&(_[1]=h,w!==void 0&&(_[2]=w))),_}const n=t;function s(l,h,w,_){const E=_??new e(3);return E[0]=l,E[1]=h,E[2]=w,E}function i(l,h){const w=h??new e(3);return w[0]=Math.ceil(l[0]),w[1]=Math.ceil(l[1]),w[2]=Math.ceil(l[2]),w}function u(l,h){const w=h??new e(3);return w[0]=Math.floor(l[0]),w[1]=Math.floor(l[1]),w[2]=Math.floor(l[2]),w}function b(l,h){const w=h??new e(3);return w[0]=Math.round(l[0]),w[1]=Math.round(l[1]),w[2]=Math.round(l[2]),w}function C(l,h=0,w=1,_){const E=_??new e(3);return E[0]=Math.min(w,Math.max(h,l[0])),E[1]=Math.min(w,Math.max(h,l[1])),E[2]=Math.min(w,Math.max(h,l[2])),E}function O(l,h,w){const _=w??new e(3);return _[0]=l[0]+h[0],_[1]=l[1]+h[1],_[2]=l[2]+h[2],_}function T(l,h,w,_){const E=_??new e(3);return E[0]=l[0]+h[0]*w,E[1]=l[1]+h[1]*w,E[2]=l[2]+h[2]*w,E}function N(l,h){const w=l[0],_=l[1],E=l[2],M=h[0],S=h[1],F=h[2],G=Math.sqrt(w*w+_*_+E*E),R=Math.sqrt(M*M+S*S+F*F),I=G*R,Z=I&&Ft(l,h)/I;return Math.acos(Z)}function L(l,h,w){const _=w??new e(3);return _[0]=l[0]-h[0],_[1]=l[1]-h[1],_[2]=l[2]-h[2],_}const j=L;function rt(l,h){return Math.abs(l[0]-h[0])<W&&Math.abs(l[1]-h[1])<W&&Math.abs(l[2]-h[2])<W}function K(l,h){return l[0]===h[0]&&l[1]===h[1]&&l[2]===h[2]}function H(l,h,w,_){const E=_??new e(3);return E[0]=l[0]+w*(h[0]-l[0]),E[1]=l[1]+w*(h[1]-l[1]),E[2]=l[2]+w*(h[2]-l[2]),E}function ct(l,h,w,_){const E=_??new e(3);return E[0]=l[0]+w[0]*(h[0]-l[0]),E[1]=l[1]+w[1]*(h[1]-l[1]),E[2]=l[2]+w[2]*(h[2]-l[2]),E}function _t(l,h,w){const _=w??new e(3);return _[0]=Math.max(l[0],h[0]),_[1]=Math.max(l[1],h[1]),_[2]=Math.max(l[2],h[2]),_}function Tt(l,h,w){const _=w??new e(3);return _[0]=Math.min(l[0],h[0]),_[1]=Math.min(l[1],h[1]),_[2]=Math.min(l[2],h[2]),_}function St(l,h,w){const _=w??new e(3);return _[0]=l[0]*h,_[1]=l[1]*h,_[2]=l[2]*h,_}const Qt=St;function jt(l,h,w){const _=w??new e(3);return _[0]=l[0]/h,_[1]=l[1]/h,_[2]=l[2]/h,_}function qt(l,h){const w=h??new e(3);return w[0]=1/l[0],w[1]=1/l[1],w[2]=1/l[2],w}const Yt=qt;function Nt(l,h,w){const _=w??new e(3),E=l[2]*h[0]-l[0]*h[2],M=l[0]*h[1]-l[1]*h[0];return _[0]=l[1]*h[2]-l[2]*h[1],_[1]=E,_[2]=M,_}function Ft(l,h){return l[0]*h[0]+l[1]*h[1]+l[2]*h[2]}function gt(l){const h=l[0],w=l[1],_=l[2];return Math.sqrt(h*h+w*w+_*_)}const Jt=gt;function nt(l){const h=l[0],w=l[1],_=l[2];return h*h+w*w+_*_}const lt=nt;function J(l,h){const w=l[0]-h[0],_=l[1]-h[1],E=l[2]-h[2];return Math.sqrt(w*w+_*_+E*E)}const m=J;function A(l,h){const w=l[0]-h[0],_=l[1]-h[1],E=l[2]-h[2];return w*w+_*_+E*E}const P=A;function V(l,h){const w=h??new e(3),_=l[0],E=l[1],M=l[2],S=Math.sqrt(_*_+E*E+M*M);return S>1e-5?(w[0]=_/S,w[1]=E/S,w[2]=M/S):(w[0]=0,w[1]=0,w[2]=0),w}function q(l,h){const w=h??new e(3);return w[0]=-l[0],w[1]=-l[1],w[2]=-l[2],w}function z(l,h){const w=h??new e(3);return w[0]=l[0],w[1]=l[1],w[2]=l[2],w}const Y=z;function X(l,h,w){const _=w??new e(3);return _[0]=l[0]*h[0],_[1]=l[1]*h[1],_[2]=l[2]*h[2],_}const tt=X;function U(l,h,w){const _=w??new e(3);return _[0]=l[0]/h[0],_[1]=l[1]/h[1],_[2]=l[2]/h[2],_}const $=U;function st(l=1,h){const w=h??new e(3),_=Math.random()*2*Math.PI,E=Math.random()*2-1,M=Math.sqrt(1-E*E)*l;return w[0]=Math.cos(_)*M,w[1]=Math.sin(_)*M,w[2]=E*l,w}function y(l){const h=l??new e(3);return h[0]=0,h[1]=0,h[2]=0,h}function D(l,h,w){const _=w??new e(3),E=l[0],M=l[1],S=l[2],F=h[3]*E+h[7]*M+h[11]*S+h[15]||1;return _[0]=(h[0]*E+h[4]*M+h[8]*S+h[12])/F,_[1]=(h[1]*E+h[5]*M+h[9]*S+h[13])/F,_[2]=(h[2]*E+h[6]*M+h[10]*S+h[14])/F,_}function p(l,h,w){const _=w??new e(3),E=l[0],M=l[1],S=l[2];return _[0]=E*h[0*4+0]+M*h[1*4+0]+S*h[2*4+0],_[1]=E*h[0*4+1]+M*h[1*4+1]+S*h[2*4+1],_[2]=E*h[0*4+2]+M*h[1*4+2]+S*h[2*4+2],_}function d(l,h,w){const _=w??new e(3),E=l[0],M=l[1],S=l[2];return _[0]=E*h[0]+M*h[4]+S*h[8],_[1]=E*h[1]+M*h[5]+S*h[9],_[2]=E*h[2]+M*h[6]+S*h[10],_}function f(l,h,w){const _=w??new e(3),E=h[0],M=h[1],S=h[2],F=h[3]*2,G=l[0],R=l[1],I=l[2],Z=M*I-S*R,et=S*G-E*I,dt=E*R-M*G;return _[0]=G+Z*F+(M*dt-S*et)*2,_[1]=R+et*F+(S*Z-E*dt)*2,_[2]=I+dt*F+(E*et-M*Z)*2,_}function g(l,h){const w=h??new e(3);return w[0]=l[12],w[1]=l[13],w[2]=l[14],w}function B(l,h,w){const _=w??new e(3),E=h*4;return _[0]=l[E+0],_[1]=l[E+1],_[2]=l[E+2],_}function r(l,h){const w=h??new e(3),_=l[0],E=l[1],M=l[2],S=l[4],F=l[5],G=l[6],R=l[8],I=l[9],Z=l[10];return w[0]=Math.sqrt(_*_+E*E+M*M),w[1]=Math.sqrt(S*S+F*F+G*G),w[2]=Math.sqrt(R*R+I*I+Z*Z),w}function c(l,h,w,_){const E=_??new e(3),M=[],S=[];return M[0]=l[0]-h[0],M[1]=l[1]-h[1],M[2]=l[2]-h[2],S[0]=M[0],S[1]=M[1]*Math.cos(w)-M[2]*Math.sin(w),S[2]=M[1]*Math.sin(w)+M[2]*Math.cos(w),E[0]=S[0]+h[0],E[1]=S[1]+h[1],E[2]=S[2]+h[2],E}function o(l,h,w,_){const E=_??new e(3),M=[],S=[];return M[0]=l[0]-h[0],M[1]=l[1]-h[1],M[2]=l[2]-h[2],S[0]=M[2]*Math.sin(w)+M[0]*Math.cos(w),S[1]=M[1],S[2]=M[2]*Math.cos(w)-M[0]*Math.sin(w),E[0]=S[0]+h[0],E[1]=S[1]+h[1],E[2]=S[2]+h[2],E}function a(l,h,w,_){const E=_??new e(3),M=[],S=[];return M[0]=l[0]-h[0],M[1]=l[1]-h[1],M[2]=l[2]-h[2],S[0]=M[0]*Math.cos(w)-M[1]*Math.sin(w),S[1]=M[0]*Math.sin(w)+M[1]*Math.cos(w),S[2]=M[2],E[0]=S[0]+h[0],E[1]=S[1]+h[1],E[2]=S[2]+h[2],E}function v(l,h,w){const _=w??new e(3);return V(l,_),St(_,h,_)}function x(l,h,w){const _=w??new e(3);return gt(l)>h?v(l,h,_):z(l,_)}function k(l,h,w){const _=w??new e(3);return H(l,h,.5,_)}return{create:t,fromValues:n,set:s,ceil:i,floor:u,round:b,clamp:C,add:O,addScaled:T,angle:N,subtract:L,sub:j,equalsApproximately:rt,equals:K,lerp:H,lerpV:ct,max:_t,min:Tt,mulScalar:St,scale:Qt,divScalar:jt,inverse:qt,invert:Yt,cross:Nt,dot:Ft,length:gt,len:Jt,lengthSq:nt,lenSq:lt,distance:J,dist:m,distanceSq:A,distSq:P,normalize:V,negate:q,copy:z,clone:Y,multiply:X,mul:tt,divide:U,div:$,random:st,zero:y,transformMat4:D,transformMat4Upper3x3:p,transformMat3:d,transformQuat:f,getTranslation:g,getAxis:B,getScaling:r,rotateX:c,rotateY:o,rotateZ:a,setLength:v,truncate:x,midpoint:k}}const Ds=new Map;function Kn(e){let t=Ds.get(e);return t||(t=yi(e),Ds.set(e,t)),t}function Pi(e){const t=Kn(e);function n(r,c,o,a,v,x,k,l,h,w,_,E,M,S,F,G){const R=new e(16);return r!==void 0&&(R[0]=r,c!==void 0&&(R[1]=c,o!==void 0&&(R[2]=o,a!==void 0&&(R[3]=a,v!==void 0&&(R[4]=v,x!==void 0&&(R[5]=x,k!==void 0&&(R[6]=k,l!==void 0&&(R[7]=l,h!==void 0&&(R[8]=h,w!==void 0&&(R[9]=w,_!==void 0&&(R[10]=_,E!==void 0&&(R[11]=E,M!==void 0&&(R[12]=M,S!==void 0&&(R[13]=S,F!==void 0&&(R[14]=F,G!==void 0&&(R[15]=G)))))))))))))))),R}function s(r,c,o,a,v,x,k,l,h,w,_,E,M,S,F,G,R){const I=R??new e(16);return I[0]=r,I[1]=c,I[2]=o,I[3]=a,I[4]=v,I[5]=x,I[6]=k,I[7]=l,I[8]=h,I[9]=w,I[10]=_,I[11]=E,I[12]=M,I[13]=S,I[14]=F,I[15]=G,I}function i(r,c){const o=c??new e(16);return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=0,o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=0,o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function u(r,c){const o=c??new e(16),a=r[0],v=r[1],x=r[2],k=r[3],l=a+a,h=v+v,w=x+x,_=a*l,E=v*l,M=v*h,S=x*l,F=x*h,G=x*w,R=k*l,I=k*h,Z=k*w;return o[0]=1-M-G,o[1]=E+Z,o[2]=S-I,o[3]=0,o[4]=E-Z,o[5]=1-_-G,o[6]=F+R,o[7]=0,o[8]=S+I,o[9]=F-R,o[10]=1-_-M,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function b(r,c){const o=c??new e(16);return o[0]=-r[0],o[1]=-r[1],o[2]=-r[2],o[3]=-r[3],o[4]=-r[4],o[5]=-r[5],o[6]=-r[6],o[7]=-r[7],o[8]=-r[8],o[9]=-r[9],o[10]=-r[10],o[11]=-r[11],o[12]=-r[12],o[13]=-r[13],o[14]=-r[14],o[15]=-r[15],o}function C(r,c){const o=c??new e(16);return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o}const O=C;function T(r,c){return Math.abs(r[0]-c[0])<W&&Math.abs(r[1]-c[1])<W&&Math.abs(r[2]-c[2])<W&&Math.abs(r[3]-c[3])<W&&Math.abs(r[4]-c[4])<W&&Math.abs(r[5]-c[5])<W&&Math.abs(r[6]-c[6])<W&&Math.abs(r[7]-c[7])<W&&Math.abs(r[8]-c[8])<W&&Math.abs(r[9]-c[9])<W&&Math.abs(r[10]-c[10])<W&&Math.abs(r[11]-c[11])<W&&Math.abs(r[12]-c[12])<W&&Math.abs(r[13]-c[13])<W&&Math.abs(r[14]-c[14])<W&&Math.abs(r[15]-c[15])<W}function N(r,c){return r[0]===c[0]&&r[1]===c[1]&&r[2]===c[2]&&r[3]===c[3]&&r[4]===c[4]&&r[5]===c[5]&&r[6]===c[6]&&r[7]===c[7]&&r[8]===c[8]&&r[9]===c[9]&&r[10]===c[10]&&r[11]===c[11]&&r[12]===c[12]&&r[13]===c[13]&&r[14]===c[14]&&r[15]===c[15]}function L(r){const c=r??new e(16);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function j(r,c){const o=c??new e(16);if(o===r){let et;return et=r[1],r[1]=r[4],r[4]=et,et=r[2],r[2]=r[8],r[8]=et,et=r[3],r[3]=r[12],r[12]=et,et=r[6],r[6]=r[9],r[9]=et,et=r[7],r[7]=r[13],r[13]=et,et=r[11],r[11]=r[14],r[14]=et,o}const a=r[0*4+0],v=r[0*4+1],x=r[0*4+2],k=r[0*4+3],l=r[1*4+0],h=r[1*4+1],w=r[1*4+2],_=r[1*4+3],E=r[2*4+0],M=r[2*4+1],S=r[2*4+2],F=r[2*4+3],G=r[3*4+0],R=r[3*4+1],I=r[3*4+2],Z=r[3*4+3];return o[0]=a,o[1]=l,o[2]=E,o[3]=G,o[4]=v,o[5]=h,o[6]=M,o[7]=R,o[8]=x,o[9]=w,o[10]=S,o[11]=I,o[12]=k,o[13]=_,o[14]=F,o[15]=Z,o}function rt(r,c){const o=c??new e(16),a=r[0*4+0],v=r[0*4+1],x=r[0*4+2],k=r[0*4+3],l=r[1*4+0],h=r[1*4+1],w=r[1*4+2],_=r[1*4+3],E=r[2*4+0],M=r[2*4+1],S=r[2*4+2],F=r[2*4+3],G=r[3*4+0],R=r[3*4+1],I=r[3*4+2],Z=r[3*4+3],et=S*Z,dt=I*F,mt=w*Z,bt=I*_,xt=w*F,yt=S*_,Pt=x*Z,Ct=I*k,Et=x*F,Mt=S*k,Vt=x*_,Dt=w*k,At=E*R,Bt=G*M,Ut=l*R,$t=G*h,Kt=l*M,an=E*h,ln=a*R,cn=G*v,un=a*M,pn=E*v,dn=a*h,hn=l*v,gs=et*h+bt*M+xt*R-(dt*h+mt*M+yt*R),xs=dt*v+Pt*M+Mt*R-(et*v+Ct*M+Et*R),ys=mt*v+Ct*h+Vt*R-(bt*v+Pt*h+Dt*R),Ps=yt*v+Et*h+Dt*M-(xt*v+Mt*h+Vt*M),kt=1/(a*gs+l*xs+E*ys+G*Ps);return o[0]=kt*gs,o[1]=kt*xs,o[2]=kt*ys,o[3]=kt*Ps,o[4]=kt*(dt*l+mt*E+yt*G-(et*l+bt*E+xt*G)),o[5]=kt*(et*a+Ct*E+Et*G-(dt*a+Pt*E+Mt*G)),o[6]=kt*(bt*a+Pt*l+Dt*G-(mt*a+Ct*l+Vt*G)),o[7]=kt*(xt*a+Mt*l+Vt*E-(yt*a+Et*l+Dt*E)),o[8]=kt*(At*_+$t*F+Kt*Z-(Bt*_+Ut*F+an*Z)),o[9]=kt*(Bt*k+ln*F+pn*Z-(At*k+cn*F+un*Z)),o[10]=kt*(Ut*k+cn*_+dn*Z-($t*k+ln*_+hn*Z)),o[11]=kt*(an*k+un*_+hn*F-(Kt*k+pn*_+dn*F)),o[12]=kt*(Ut*S+an*I+Bt*w-(Kt*I+At*w+$t*S)),o[13]=kt*(un*I+At*x+cn*S-(ln*S+pn*I+Bt*x)),o[14]=kt*(ln*w+hn*I+$t*x-(dn*I+Ut*x+cn*w)),o[15]=kt*(dn*S+Kt*x+pn*w-(un*w+hn*S+an*x)),o}function K(r){const c=r[0],o=r[0*4+1],a=r[0*4+2],v=r[0*4+3],x=r[1*4+0],k=r[1*4+1],l=r[1*4+2],h=r[1*4+3],w=r[2*4+0],_=r[2*4+1],E=r[2*4+2],M=r[2*4+3],S=r[3*4+0],F=r[3*4+1],G=r[3*4+2],R=r[3*4+3],I=E*R,Z=G*M,et=l*R,dt=G*h,mt=l*M,bt=E*h,xt=a*R,yt=G*v,Pt=a*M,Ct=E*v,Et=a*h,Mt=l*v,Vt=I*k+dt*_+mt*F-(Z*k+et*_+bt*F),Dt=Z*o+xt*_+Ct*F-(I*o+yt*_+Pt*F),At=et*o+yt*k+Et*F-(dt*o+xt*k+Mt*F),Bt=bt*o+Pt*k+Mt*_-(mt*o+Ct*k+Et*_);return c*Vt+x*Dt+w*At+S*Bt}const H=rt;function ct(r,c,o){const a=o??new e(16),v=r[0],x=r[1],k=r[2],l=r[3],h=r[4],w=r[5],_=r[6],E=r[7],M=r[8],S=r[9],F=r[10],G=r[11],R=r[12],I=r[13],Z=r[14],et=r[15],dt=c[0],mt=c[1],bt=c[2],xt=c[3],yt=c[4],Pt=c[5],Ct=c[6],Et=c[7],Mt=c[8],Vt=c[9],Dt=c[10],At=c[11],Bt=c[12],Ut=c[13],$t=c[14],Kt=c[15];return a[0]=v*dt+h*mt+M*bt+R*xt,a[1]=x*dt+w*mt+S*bt+I*xt,a[2]=k*dt+_*mt+F*bt+Z*xt,a[3]=l*dt+E*mt+G*bt+et*xt,a[4]=v*yt+h*Pt+M*Ct+R*Et,a[5]=x*yt+w*Pt+S*Ct+I*Et,a[6]=k*yt+_*Pt+F*Ct+Z*Et,a[7]=l*yt+E*Pt+G*Ct+et*Et,a[8]=v*Mt+h*Vt+M*Dt+R*At,a[9]=x*Mt+w*Vt+S*Dt+I*At,a[10]=k*Mt+_*Vt+F*Dt+Z*At,a[11]=l*Mt+E*Vt+G*Dt+et*At,a[12]=v*Bt+h*Ut+M*$t+R*Kt,a[13]=x*Bt+w*Ut+S*$t+I*Kt,a[14]=k*Bt+_*Ut+F*$t+Z*Kt,a[15]=l*Bt+E*Ut+G*$t+et*Kt,a}const _t=ct;function Tt(r,c,o){const a=o??L();return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11]),a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a}function St(r,c){const o=c??t.create();return o[0]=r[12],o[1]=r[13],o[2]=r[14],o}function Qt(r,c,o){const a=o??t.create(),v=c*4;return a[0]=r[v+0],a[1]=r[v+1],a[2]=r[v+2],a}function jt(r,c,o,a){const v=a===r?a:C(r,a),x=o*4;return v[x+0]=c[0],v[x+1]=c[1],v[x+2]=c[2],v}function qt(r,c){const o=c??t.create(),a=r[0],v=r[1],x=r[2],k=r[4],l=r[5],h=r[6],w=r[8],_=r[9],E=r[10];return o[0]=Math.sqrt(a*a+v*v+x*x),o[1]=Math.sqrt(k*k+l*l+h*h),o[2]=Math.sqrt(w*w+_*_+E*E),o}function Yt(r,c,o,a,v){const x=v??new e(16),k=Math.tan(Math.PI*.5-.5*r);if(x[0]=k/c,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=k,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,Number.isFinite(a)){const l=1/(o-a);x[10]=a*l,x[14]=a*o*l}else x[10]=-1,x[14]=-o;return x}function Nt(r,c,o,a=1/0,v){const x=v??new e(16),k=1/Math.tan(r*.5);if(x[0]=k/c,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=k,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,a===1/0)x[10]=0,x[14]=o;else{const l=1/(a-o);x[10]=o*l,x[14]=a*o*l}return x}function Ft(r,c,o,a,v,x,k){const l=k??new e(16);return l[0]=2/(c-r),l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2/(a-o),l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1/(v-x),l[11]=0,l[12]=(c+r)/(r-c),l[13]=(a+o)/(o-a),l[14]=v/(v-x),l[15]=1,l}function gt(r,c,o,a,v,x,k){const l=k??new e(16),h=c-r,w=a-o,_=v-x;return l[0]=2*v/h,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2*v/w,l[6]=0,l[7]=0,l[8]=(r+c)/h,l[9]=(a+o)/w,l[10]=x/_,l[11]=-1,l[12]=0,l[13]=0,l[14]=v*x/_,l[15]=0,l}function Jt(r,c,o,a,v,x=1/0,k){const l=k??new e(16),h=c-r,w=a-o;if(l[0]=2*v/h,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2*v/w,l[6]=0,l[7]=0,l[8]=(r+c)/h,l[9]=(a+o)/w,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,x===1/0)l[10]=0,l[14]=v;else{const _=1/(x-v);l[10]=v*_,l[14]=x*v*_}return l}const nt=t.create(),lt=t.create(),J=t.create();function m(r,c,o,a){const v=a??new e(16);return t.normalize(t.subtract(c,r,J),J),t.normalize(t.cross(o,J,nt),nt),t.normalize(t.cross(J,nt,lt),lt),v[0]=nt[0],v[1]=nt[1],v[2]=nt[2],v[3]=0,v[4]=lt[0],v[5]=lt[1],v[6]=lt[2],v[7]=0,v[8]=J[0],v[9]=J[1],v[10]=J[2],v[11]=0,v[12]=r[0],v[13]=r[1],v[14]=r[2],v[15]=1,v}function A(r,c,o,a){const v=a??new e(16);return t.normalize(t.subtract(r,c,J),J),t.normalize(t.cross(o,J,nt),nt),t.normalize(t.cross(J,nt,lt),lt),v[0]=nt[0],v[1]=nt[1],v[2]=nt[2],v[3]=0,v[4]=lt[0],v[5]=lt[1],v[6]=lt[2],v[7]=0,v[8]=J[0],v[9]=J[1],v[10]=J[2],v[11]=0,v[12]=r[0],v[13]=r[1],v[14]=r[2],v[15]=1,v}function P(r,c,o,a){const v=a??new e(16);return t.normalize(t.subtract(r,c,J),J),t.normalize(t.cross(o,J,nt),nt),t.normalize(t.cross(J,nt,lt),lt),v[0]=nt[0],v[1]=lt[0],v[2]=J[0],v[3]=0,v[4]=nt[1],v[5]=lt[1],v[6]=J[1],v[7]=0,v[8]=nt[2],v[9]=lt[2],v[10]=J[2],v[11]=0,v[12]=-(nt[0]*r[0]+nt[1]*r[1]+nt[2]*r[2]),v[13]=-(lt[0]*r[0]+lt[1]*r[1]+lt[2]*r[2]),v[14]=-(J[0]*r[0]+J[1]*r[1]+J[2]*r[2]),v[15]=1,v}function V(r,c){const o=c??new e(16);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=r[0],o[13]=r[1],o[14]=r[2],o[15]=1,o}function q(r,c,o){const a=o??new e(16),v=c[0],x=c[1],k=c[2],l=r[0],h=r[1],w=r[2],_=r[3],E=r[1*4+0],M=r[1*4+1],S=r[1*4+2],F=r[1*4+3],G=r[2*4+0],R=r[2*4+1],I=r[2*4+2],Z=r[2*4+3],et=r[3*4+0],dt=r[3*4+1],mt=r[3*4+2],bt=r[3*4+3];return r!==a&&(a[0]=l,a[1]=h,a[2]=w,a[3]=_,a[4]=E,a[5]=M,a[6]=S,a[7]=F,a[8]=G,a[9]=R,a[10]=I,a[11]=Z),a[12]=l*v+E*x+G*k+et,a[13]=h*v+M*x+R*k+dt,a[14]=w*v+S*x+I*k+mt,a[15]=_*v+F*x+Z*k+bt,a}function z(r,c){const o=c??new e(16),a=Math.cos(r),v=Math.sin(r);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=a,o[6]=v,o[7]=0,o[8]=0,o[9]=-v,o[10]=a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Y(r,c,o){const a=o??new e(16),v=r[4],x=r[5],k=r[6],l=r[7],h=r[8],w=r[9],_=r[10],E=r[11],M=Math.cos(c),S=Math.sin(c);return a[4]=M*v+S*h,a[5]=M*x+S*w,a[6]=M*k+S*_,a[7]=M*l+S*E,a[8]=M*h-S*v,a[9]=M*w-S*x,a[10]=M*_-S*k,a[11]=M*E-S*l,r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a}function X(r,c){const o=c??new e(16),a=Math.cos(r),v=Math.sin(r);return o[0]=a,o[1]=0,o[2]=-v,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=v,o[9]=0,o[10]=a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function tt(r,c,o){const a=o??new e(16),v=r[0*4+0],x=r[0*4+1],k=r[0*4+2],l=r[0*4+3],h=r[2*4+0],w=r[2*4+1],_=r[2*4+2],E=r[2*4+3],M=Math.cos(c),S=Math.sin(c);return a[0]=M*v-S*h,a[1]=M*x-S*w,a[2]=M*k-S*_,a[3]=M*l-S*E,a[8]=M*h+S*v,a[9]=M*w+S*x,a[10]=M*_+S*k,a[11]=M*E+S*l,r!==a&&(a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a}function U(r,c){const o=c??new e(16),a=Math.cos(r),v=Math.sin(r);return o[0]=a,o[1]=v,o[2]=0,o[3]=0,o[4]=-v,o[5]=a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function $(r,c,o){const a=o??new e(16),v=r[0*4+0],x=r[0*4+1],k=r[0*4+2],l=r[0*4+3],h=r[1*4+0],w=r[1*4+1],_=r[1*4+2],E=r[1*4+3],M=Math.cos(c),S=Math.sin(c);return a[0]=M*v+S*h,a[1]=M*x+S*w,a[2]=M*k+S*_,a[3]=M*l+S*E,a[4]=M*h-S*v,a[5]=M*w-S*x,a[6]=M*_-S*k,a[7]=M*E-S*l,r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a}function st(r,c,o){const a=o??new e(16);let v=r[0],x=r[1],k=r[2];const l=Math.sqrt(v*v+x*x+k*k);v/=l,x/=l,k/=l;const h=v*v,w=x*x,_=k*k,E=Math.cos(c),M=Math.sin(c),S=1-E;return a[0]=h+(1-h)*E,a[1]=v*x*S+k*M,a[2]=v*k*S-x*M,a[3]=0,a[4]=v*x*S-k*M,a[5]=w+(1-w)*E,a[6]=x*k*S+v*M,a[7]=0,a[8]=v*k*S+x*M,a[9]=x*k*S-v*M,a[10]=_+(1-_)*E,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}const y=st;function D(r,c,o,a){const v=a??new e(16);let x=c[0],k=c[1],l=c[2];const h=Math.sqrt(x*x+k*k+l*l);x/=h,k/=h,l/=h;const w=x*x,_=k*k,E=l*l,M=Math.cos(o),S=Math.sin(o),F=1-M,G=w+(1-w)*M,R=x*k*F+l*S,I=x*l*F-k*S,Z=x*k*F-l*S,et=_+(1-_)*M,dt=k*l*F+x*S,mt=x*l*F+k*S,bt=k*l*F-x*S,xt=E+(1-E)*M,yt=r[0],Pt=r[1],Ct=r[2],Et=r[3],Mt=r[4],Vt=r[5],Dt=r[6],At=r[7],Bt=r[8],Ut=r[9],$t=r[10],Kt=r[11];return v[0]=G*yt+R*Mt+I*Bt,v[1]=G*Pt+R*Vt+I*Ut,v[2]=G*Ct+R*Dt+I*$t,v[3]=G*Et+R*At+I*Kt,v[4]=Z*yt+et*Mt+dt*Bt,v[5]=Z*Pt+et*Vt+dt*Ut,v[6]=Z*Ct+et*Dt+dt*$t,v[7]=Z*Et+et*At+dt*Kt,v[8]=mt*yt+bt*Mt+xt*Bt,v[9]=mt*Pt+bt*Vt+xt*Ut,v[10]=mt*Ct+bt*Dt+xt*$t,v[11]=mt*Et+bt*At+xt*Kt,r!==v&&(v[12]=r[12],v[13]=r[13],v[14]=r[14],v[15]=r[15]),v}const p=D;function d(r,c){const o=c??new e(16);return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function f(r,c,o){const a=o??new e(16),v=c[0],x=c[1],k=c[2];return a[0]=v*r[0*4+0],a[1]=v*r[0*4+1],a[2]=v*r[0*4+2],a[3]=v*r[0*4+3],a[4]=x*r[1*4+0],a[5]=x*r[1*4+1],a[6]=x*r[1*4+2],a[7]=x*r[1*4+3],a[8]=k*r[2*4+0],a[9]=k*r[2*4+1],a[10]=k*r[2*4+2],a[11]=k*r[2*4+3],r!==a&&(a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a}function g(r,c){const o=c??new e(16);return o[0]=r,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function B(r,c,o){const a=o??new e(16);return a[0]=c*r[0*4+0],a[1]=c*r[0*4+1],a[2]=c*r[0*4+2],a[3]=c*r[0*4+3],a[4]=c*r[1*4+0],a[5]=c*r[1*4+1],a[6]=c*r[1*4+2],a[7]=c*r[1*4+3],a[8]=c*r[2*4+0],a[9]=c*r[2*4+1],a[10]=c*r[2*4+2],a[11]=c*r[2*4+3],r!==a&&(a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a}return{create:n,set:s,fromMat3:i,fromQuat:u,negate:b,copy:C,clone:O,equalsApproximately:T,equals:N,identity:L,transpose:j,inverse:rt,determinant:K,invert:H,multiply:ct,mul:_t,setTranslation:Tt,getTranslation:St,getAxis:Qt,setAxis:jt,getScaling:qt,perspective:Yt,perspectiveReverseZ:Nt,ortho:Ft,frustum:gt,frustumReverseZ:Jt,aim:m,cameraAim:A,lookAt:P,translation:V,translate:q,rotationX:z,rotateX:Y,rotationY:X,rotateY:tt,rotationZ:U,rotateZ:$,axisRotation:st,rotation:y,axisRotate:D,rotate:p,scaling:d,scale:f,uniformScaling:g,uniformScale:B}}const As=new Map;function Ci(e){let t=As.get(e);return t||(t=Pi(e),As.set(e,t)),t}function Ei(e){const t=Kn(e);function n(y,D,p,d){const f=new e(4);return y!==void 0&&(f[0]=y,D!==void 0&&(f[1]=D,p!==void 0&&(f[2]=p,d!==void 0&&(f[3]=d)))),f}const s=n;function i(y,D,p,d,f){const g=f??new e(4);return g[0]=y,g[1]=D,g[2]=p,g[3]=d,g}function u(y,D,p){const d=p??new e(4),f=D*.5,g=Math.sin(f);return d[0]=g*y[0],d[1]=g*y[1],d[2]=g*y[2],d[3]=Math.cos(f),d}function b(y,D){const p=D??t.create(3),d=Math.acos(y[3])*2,f=Math.sin(d*.5);return f>W?(p[0]=y[0]/f,p[1]=y[1]/f,p[2]=y[2]/f):(p[0]=1,p[1]=0,p[2]=0),{angle:d,axis:p}}function C(y,D){const p=gt(y,D);return Math.acos(2*p*p-1)}function O(y,D,p){const d=p??new e(4),f=y[0],g=y[1],B=y[2],r=y[3],c=D[0],o=D[1],a=D[2],v=D[3];return d[0]=f*v+r*c+g*a-B*o,d[1]=g*v+r*o+B*c-f*a,d[2]=B*v+r*a+f*o-g*c,d[3]=r*v-f*c-g*o-B*a,d}const T=O;function N(y,D,p){const d=p??new e(4),f=D*.5,g=y[0],B=y[1],r=y[2],c=y[3],o=Math.sin(f),a=Math.cos(f);return d[0]=g*a+c*o,d[1]=B*a+r*o,d[2]=r*a-B*o,d[3]=c*a-g*o,d}function L(y,D,p){const d=p??new e(4),f=D*.5,g=y[0],B=y[1],r=y[2],c=y[3],o=Math.sin(f),a=Math.cos(f);return d[0]=g*a-r*o,d[1]=B*a+c*o,d[2]=r*a+g*o,d[3]=c*a-B*o,d}function j(y,D,p){const d=p??new e(4),f=D*.5,g=y[0],B=y[1],r=y[2],c=y[3],o=Math.sin(f),a=Math.cos(f);return d[0]=g*a+B*o,d[1]=B*a-g*o,d[2]=r*a+c*o,d[3]=c*a-r*o,d}function rt(y,D,p,d){const f=d??new e(4),g=y[0],B=y[1],r=y[2],c=y[3];let o=D[0],a=D[1],v=D[2],x=D[3],k=g*o+B*a+r*v+c*x;k<0&&(k=-k,o=-o,a=-a,v=-v,x=-x);let l,h;if(1-k>W){const w=Math.acos(k),_=Math.sin(w);l=Math.sin((1-p)*w)/_,h=Math.sin(p*w)/_}else l=1-p,h=p;return f[0]=l*g+h*o,f[1]=l*B+h*a,f[2]=l*r+h*v,f[3]=l*c+h*x,f}function K(y,D){const p=D??new e(4),d=y[0],f=y[1],g=y[2],B=y[3],r=d*d+f*f+g*g+B*B,c=r?1/r:0;return p[0]=-d*c,p[1]=-f*c,p[2]=-g*c,p[3]=B*c,p}function H(y,D){const p=D??new e(4);return p[0]=-y[0],p[1]=-y[1],p[2]=-y[2],p[3]=y[3],p}function ct(y,D){const p=D??new e(4),d=y[0]+y[5]+y[10];if(d>0){const f=Math.sqrt(d+1);p[3]=.5*f;const g=.5/f;p[0]=(y[6]-y[9])*g,p[1]=(y[8]-y[2])*g,p[2]=(y[1]-y[4])*g}else{let f=0;y[5]>y[0]&&(f=1),y[10]>y[f*4+f]&&(f=2);const g=(f+1)%3,B=(f+2)%3,r=Math.sqrt(y[f*4+f]-y[g*4+g]-y[B*4+B]+1);p[f]=.5*r;const c=.5/r;p[3]=(y[g*4+B]-y[B*4+g])*c,p[g]=(y[g*4+f]+y[f*4+g])*c,p[B]=(y[B*4+f]+y[f*4+B])*c}return p}function _t(y,D,p,d,f){const g=f??new e(4),B=y*.5,r=D*.5,c=p*.5,o=Math.sin(B),a=Math.cos(B),v=Math.sin(r),x=Math.cos(r),k=Math.sin(c),l=Math.cos(c);switch(d){case"xyz":g[0]=o*x*l+a*v*k,g[1]=a*v*l-o*x*k,g[2]=a*x*k+o*v*l,g[3]=a*x*l-o*v*k;break;case"xzy":g[0]=o*x*l-a*v*k,g[1]=a*v*l-o*x*k,g[2]=a*x*k+o*v*l,g[3]=a*x*l+o*v*k;break;case"yxz":g[0]=o*x*l+a*v*k,g[1]=a*v*l-o*x*k,g[2]=a*x*k-o*v*l,g[3]=a*x*l+o*v*k;break;case"yzx":g[0]=o*x*l+a*v*k,g[1]=a*v*l+o*x*k,g[2]=a*x*k-o*v*l,g[3]=a*x*l-o*v*k;break;case"zxy":g[0]=o*x*l-a*v*k,g[1]=a*v*l+o*x*k,g[2]=a*x*k+o*v*l,g[3]=a*x*l-o*v*k;break;case"zyx":g[0]=o*x*l-a*v*k,g[1]=a*v*l+o*x*k,g[2]=a*x*k-o*v*l,g[3]=a*x*l+o*v*k;break;default:throw new Error(`Unknown rotation order: ${d}`)}return g}function Tt(y,D){const p=D??new e(4);return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[3]=y[3],p}const St=Tt;function Qt(y,D,p){const d=p??new e(4);return d[0]=y[0]+D[0],d[1]=y[1]+D[1],d[2]=y[2]+D[2],d[3]=y[3]+D[3],d}function jt(y,D,p){const d=p??new e(4);return d[0]=y[0]-D[0],d[1]=y[1]-D[1],d[2]=y[2]-D[2],d[3]=y[3]-D[3],d}const qt=jt;function Yt(y,D,p){const d=p??new e(4);return d[0]=y[0]*D,d[1]=y[1]*D,d[2]=y[2]*D,d[3]=y[3]*D,d}const Nt=Yt;function Ft(y,D,p){const d=p??new e(4);return d[0]=y[0]/D,d[1]=y[1]/D,d[2]=y[2]/D,d[3]=y[3]/D,d}function gt(y,D){return y[0]*D[0]+y[1]*D[1]+y[2]*D[2]+y[3]*D[3]}function Jt(y,D,p,d){const f=d??new e(4);return f[0]=y[0]+p*(D[0]-y[0]),f[1]=y[1]+p*(D[1]-y[1]),f[2]=y[2]+p*(D[2]-y[2]),f[3]=y[3]+p*(D[3]-y[3]),f}function nt(y){const D=y[0],p=y[1],d=y[2],f=y[3];return Math.sqrt(D*D+p*p+d*d+f*f)}const lt=nt;function J(y){const D=y[0],p=y[1],d=y[2],f=y[3];return D*D+p*p+d*d+f*f}const m=J;function A(y,D){const p=D??new e(4),d=y[0],f=y[1],g=y[2],B=y[3],r=Math.sqrt(d*d+f*f+g*g+B*B);return r>1e-5?(p[0]=d/r,p[1]=f/r,p[2]=g/r,p[3]=B/r):(p[0]=0,p[1]=0,p[2]=0,p[3]=1),p}function P(y,D){return Math.abs(y[0]-D[0])<W&&Math.abs(y[1]-D[1])<W&&Math.abs(y[2]-D[2])<W&&Math.abs(y[3]-D[3])<W}function V(y,D){return y[0]===D[0]&&y[1]===D[1]&&y[2]===D[2]&&y[3]===D[3]}function q(y){const D=y??new e(4);return D[0]=0,D[1]=0,D[2]=0,D[3]=1,D}const z=t.create(),Y=t.create(),X=t.create();function tt(y,D,p){const d=p??new e(4),f=t.dot(y,D);return f<-.999999?(t.cross(Y,y,z),t.len(z)<1e-6&&t.cross(X,y,z),t.normalize(z,z),u(z,Math.PI,d),d):f>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(t.cross(y,D,z),d[0]=z[0],d[1]=z[1],d[2]=z[2],d[3]=1+f,A(d,d))}const U=new e(4),$=new e(4);function st(y,D,p,d,f,g){const B=g??new e(4);return rt(y,d,f,U),rt(D,p,f,$),rt(U,$,2*f*(1-f),B),B}return{create:n,fromValues:s,set:i,fromAxisAngle:u,toAxisAngle:b,angle:C,multiply:O,mul:T,rotateX:N,rotateY:L,rotateZ:j,slerp:rt,inverse:K,conjugate:H,fromMat:ct,fromEuler:_t,copy:Tt,clone:St,add:Qt,subtract:jt,sub:qt,mulScalar:Yt,scale:Nt,divScalar:Ft,dot:gt,lerp:Jt,length:nt,len:lt,lengthSq:J,lenSq:m,normalize:A,equalsApproximately:P,equals:V,identity:q,rotationTo:tt,sqlerp:st}}const Bs=new Map;function Mi(e){let t=Bs.get(e);return t||(t=Ei(e),Bs.set(e,t)),t}function ki(e){function t(p,d,f,g){const B=new e(4);return p!==void 0&&(B[0]=p,d!==void 0&&(B[1]=d,f!==void 0&&(B[2]=f,g!==void 0&&(B[3]=g)))),B}const n=t;function s(p,d,f,g,B){const r=B??new e(4);return r[0]=p,r[1]=d,r[2]=f,r[3]=g,r}function i(p,d){const f=d??new e(4);return f[0]=Math.ceil(p[0]),f[1]=Math.ceil(p[1]),f[2]=Math.ceil(p[2]),f[3]=Math.ceil(p[3]),f}function u(p,d){const f=d??new e(4);return f[0]=Math.floor(p[0]),f[1]=Math.floor(p[1]),f[2]=Math.floor(p[2]),f[3]=Math.floor(p[3]),f}function b(p,d){const f=d??new e(4);return f[0]=Math.round(p[0]),f[1]=Math.round(p[1]),f[2]=Math.round(p[2]),f[3]=Math.round(p[3]),f}function C(p,d=0,f=1,g){const B=g??new e(4);return B[0]=Math.min(f,Math.max(d,p[0])),B[1]=Math.min(f,Math.max(d,p[1])),B[2]=Math.min(f,Math.max(d,p[2])),B[3]=Math.min(f,Math.max(d,p[3])),B}function O(p,d,f){const g=f??new e(4);return g[0]=p[0]+d[0],g[1]=p[1]+d[1],g[2]=p[2]+d[2],g[3]=p[3]+d[3],g}function T(p,d,f,g){const B=g??new e(4);return B[0]=p[0]+d[0]*f,B[1]=p[1]+d[1]*f,B[2]=p[2]+d[2]*f,B[3]=p[3]+d[3]*f,B}function N(p,d,f){const g=f??new e(4);return g[0]=p[0]-d[0],g[1]=p[1]-d[1],g[2]=p[2]-d[2],g[3]=p[3]-d[3],g}const L=N;function j(p,d){return Math.abs(p[0]-d[0])<W&&Math.abs(p[1]-d[1])<W&&Math.abs(p[2]-d[2])<W&&Math.abs(p[3]-d[3])<W}function rt(p,d){return p[0]===d[0]&&p[1]===d[1]&&p[2]===d[2]&&p[3]===d[3]}function K(p,d,f,g){const B=g??new e(4);return B[0]=p[0]+f*(d[0]-p[0]),B[1]=p[1]+f*(d[1]-p[1]),B[2]=p[2]+f*(d[2]-p[2]),B[3]=p[3]+f*(d[3]-p[3]),B}function H(p,d,f,g){const B=g??new e(4);return B[0]=p[0]+f[0]*(d[0]-p[0]),B[1]=p[1]+f[1]*(d[1]-p[1]),B[2]=p[2]+f[2]*(d[2]-p[2]),B[3]=p[3]+f[3]*(d[3]-p[3]),B}function ct(p,d,f){const g=f??new e(4);return g[0]=Math.max(p[0],d[0]),g[1]=Math.max(p[1],d[1]),g[2]=Math.max(p[2],d[2]),g[3]=Math.max(p[3],d[3]),g}function _t(p,d,f){const g=f??new e(4);return g[0]=Math.min(p[0],d[0]),g[1]=Math.min(p[1],d[1]),g[2]=Math.min(p[2],d[2]),g[3]=Math.min(p[3],d[3]),g}function Tt(p,d,f){const g=f??new e(4);return g[0]=p[0]*d,g[1]=p[1]*d,g[2]=p[2]*d,g[3]=p[3]*d,g}const St=Tt;function Qt(p,d,f){const g=f??new e(4);return g[0]=p[0]/d,g[1]=p[1]/d,g[2]=p[2]/d,g[3]=p[3]/d,g}function jt(p,d){const f=d??new e(4);return f[0]=1/p[0],f[1]=1/p[1],f[2]=1/p[2],f[3]=1/p[3],f}const qt=jt;function Yt(p,d){return p[0]*d[0]+p[1]*d[1]+p[2]*d[2]+p[3]*d[3]}function Nt(p){const d=p[0],f=p[1],g=p[2],B=p[3];return Math.sqrt(d*d+f*f+g*g+B*B)}const Ft=Nt;function gt(p){const d=p[0],f=p[1],g=p[2],B=p[3];return d*d+f*f+g*g+B*B}const Jt=gt;function nt(p,d){const f=p[0]-d[0],g=p[1]-d[1],B=p[2]-d[2],r=p[3]-d[3];return Math.sqrt(f*f+g*g+B*B+r*r)}const lt=nt;function J(p,d){const f=p[0]-d[0],g=p[1]-d[1],B=p[2]-d[2],r=p[3]-d[3];return f*f+g*g+B*B+r*r}const m=J;function A(p,d){const f=d??new e(4),g=p[0],B=p[1],r=p[2],c=p[3],o=Math.sqrt(g*g+B*B+r*r+c*c);return o>1e-5?(f[0]=g/o,f[1]=B/o,f[2]=r/o,f[3]=c/o):(f[0]=0,f[1]=0,f[2]=0,f[3]=0),f}function P(p,d){const f=d??new e(4);return f[0]=-p[0],f[1]=-p[1],f[2]=-p[2],f[3]=-p[3],f}function V(p,d){const f=d??new e(4);return f[0]=p[0],f[1]=p[1],f[2]=p[2],f[3]=p[3],f}const q=V;function z(p,d,f){const g=f??new e(4);return g[0]=p[0]*d[0],g[1]=p[1]*d[1],g[2]=p[2]*d[2],g[3]=p[3]*d[3],g}const Y=z;function X(p,d,f){const g=f??new e(4);return g[0]=p[0]/d[0],g[1]=p[1]/d[1],g[2]=p[2]/d[2],g[3]=p[3]/d[3],g}const tt=X;function U(p){const d=p??new e(4);return d[0]=0,d[1]=0,d[2]=0,d[3]=0,d}function $(p,d,f){const g=f??new e(4),B=p[0],r=p[1],c=p[2],o=p[3];return g[0]=d[0]*B+d[4]*r+d[8]*c+d[12]*o,g[1]=d[1]*B+d[5]*r+d[9]*c+d[13]*o,g[2]=d[2]*B+d[6]*r+d[10]*c+d[14]*o,g[3]=d[3]*B+d[7]*r+d[11]*c+d[15]*o,g}function st(p,d,f){const g=f??new e(4);return A(p,g),Tt(g,d,g)}function y(p,d,f){const g=f??new e(4);return Nt(p)>d?st(p,d,g):V(p,g)}function D(p,d,f){const g=f??new e(4);return K(p,d,.5,g)}return{create:t,fromValues:n,set:s,ceil:i,floor:u,round:b,clamp:C,add:O,addScaled:T,subtract:N,sub:L,equalsApproximately:j,equals:rt,lerp:K,lerpV:H,max:ct,min:_t,mulScalar:Tt,scale:St,divScalar:Qt,inverse:jt,invert:qt,dot:Yt,length:Nt,len:Ft,lengthSq:gt,lenSq:Jt,distance:nt,dist:lt,distanceSq:J,distSq:m,normalize:A,negate:P,copy:V,clone:q,multiply:z,mul:Y,divide:X,div:tt,zero:U,transformMat4:$,setLength:st,truncate:y,midpoint:D}}const Ls=new Map;function Si(e){let t=Ls.get(e);return t||(t=ki(e),Ls.set(e,t)),t}function Gn(e,t,n,s,i,u){return{mat4:Ci(e),mat3:xi(t),quat:Mi(n),vec2:or(s),vec3:Kn(i),vec4:Si(u)}}const{mat4:Ue,mat3:uu,quat:pu,vec2:du,vec3:hu,vec4:vu}=Gn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Gn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Gn(wi,Array,Array,Array,Array,Array);/*! Tweakpane 4.0.4 (c) 2016 cocopon, licensed under the MIT license. */function ut(e){return e==null}function Hn(e){return e!==null&&typeof e=="object"}function Rn(e){return e!==null&&typeof e=="object"}function Vi(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ye(e,t){return Array.from(new Set([...Object.keys(e),...Object.keys(t)])).reduce((s,i)=>{const u=e[i],b=t[i];return Rn(u)&&Rn(b)?Object.assign(Object.assign({},s),{[i]:ye(u,b)}):Object.assign(Object.assign({},s),{[i]:i in t?b:u})},{})}function Yn(e){return Hn(e)?"target"in e:!1}const Di={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:e=>`Not compatible with  plugin '${e.id}'`,propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class vt{static alreadyDisposed(){return new vt({type:"alreadydisposed"})}static notBindable(){return new vt({type:"notbindable"})}static notCompatible(t,n){return new vt({type:"notcompatible",context:{id:`${t}.${n}`}})}static propertyNotFound(t){return new vt({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new vt({type:"shouldneverhappen"})}constructor(t){var n;this.message=(n=Di[t.type](t.context))!==null&&n!==void 0?n:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}}class _n{constructor(t,n){this.obj_=t,this.key=n}static isBindable(t){return!(t===null||typeof t!="object"&&typeof t!="function")}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,n){const s=this.read();if(!_n.isBindable(s))throw vt.notBindable();if(!(t in s))throw vt.propertyNotFound(t);s[t]=n}}class ft{constructor(){this.observers_={}}on(t,n,s){var i;let u=this.observers_[t];return u||(u=this.observers_[t]=[]),u.push({handler:n,key:(i=s==null?void 0:s.key)!==null&&i!==void 0?i:n}),this}off(t,n){const s=this.observers_[t];return s&&(this.observers_[t]=s.filter(i=>i.key!==n)),this}emit(t,n){const s=this.observers_[t];s&&s.forEach(i=>{i.handler(n)})}}class Ai{constructor(t,n){var s;this.constraint_=n==null?void 0:n.constraint,this.equals_=(s=n==null?void 0:n.equals)!==null&&s!==void 0?s:(i,u)=>i===u,this.emitter=new ft,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,n){const s=n??{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(t):t,u=this.rawValue_;this.equals_(u,i)&&!s.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:s,previousRawValue:u,rawValue:i,sender:this}))}}class Bi{constructor(t){this.emitter=new ft,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,n){const s=n??{forceEmit:!1,last:!0},i=this.value_;i===t&&!s.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:s,previousRawValue:i,rawValue:this.value_,sender:this}))}}class Li{constructor(t){this.emitter=new ft,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function pt(e,t){const n=t==null?void 0:t.constraint,s=t==null?void 0:t.equals;return!n&&!s?new Bi(e):new Ai(e,t)}function Oi(e){return[new Li(e),(t,n)=>{e.setRawValue(t,n)}]}class Q{constructor(t){this.emitter=new ft,this.valMap_=t;for(const n in this.valMap_)this.valMap_[n].emitter.on("change",()=>{this.emitter.emit("change",{key:n,sender:this})})}static createCore(t){return Object.keys(t).reduce((s,i)=>Object.assign(s,{[i]:pt(t[i])}),{})}static fromObject(t){const n=this.createCore(t);return new Q(n)}get(t){return this.valMap_[t].rawValue}set(t,n){this.valMap_[t].rawValue=n}value(t){return this.valMap_[t]}}class We{constructor(t){this.values=Q.fromObject({max:t.max,min:t.min})}constrain(t){const n=this.values.get("max"),s=this.values.get("min");return Math.min(Math.max(t,s),n)}}class Ti{constructor(t){this.values=Q.fromObject({max:t.max,min:t.min})}constrain(t){const n=this.values.get("max"),s=this.values.get("min");let i=t;return ut(s)||(i=Math.max(i,s)),ut(n)||(i=Math.min(i,n)),i}}class zi{constructor(t,n=0){this.step=t,this.origin=n}constrain(t){const n=this.origin%this.step,s=Math.round((t-n)/this.step);return n+s*this.step}}class Ri{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const Ii={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class ji{constructor(t,n,s){this.left=n,this.operator=t,this.right=s}evaluate(){const t=Ii[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const qi={"+":e=>e,"-":e=>-e,"~":e=>~e};class Ni{constructor(t,n){this.operator=t,this.expression=n}evaluate(){const t=qi[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Xn(e){return(t,n)=>{for(let s=0;s<e.length;s++){const i=e[s](t,n);if(i!=="")return i}return""}}function $e(e,t){var n;const s=e.substr(t).match(/^\s+/);return(n=s&&s[0])!==null&&n!==void 0?n:""}function Fi(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}function Ke(e,t){var n;const s=e.substr(t).match(/^[0-9]+/);return(n=s&&s[0])!==null&&n!==void 0?n:""}function Ui(e,t){const n=Ke(e,t);if(n!=="")return n;const s=e.substr(t,1);if(t+=1,s!=="-"&&s!=="+")return"";const i=Ke(e,t);return i===""?"":s+i}function Wn(e,t){const n=e.substr(t,1);if(t+=1,n.toLowerCase()!=="e")return"";const s=Ui(e,t);return s===""?"":n+s}function ar(e,t){const n=e.substr(t,1);if(n==="0")return n;const s=Fi(e,t);return t+=s.length,s===""?"":s+Ke(e,t)}function $i(e,t){const n=ar(e,t);if(t+=n.length,n==="")return"";const s=e.substr(t,1);if(t+=s.length,s!==".")return"";const i=Ke(e,t);return t+=i.length,n+s+i+Wn(e,t)}function Ki(e,t){const n=e.substr(t,1);if(t+=n.length,n!==".")return"";const s=Ke(e,t);return t+=s.length,s===""?"":n+s+Wn(e,t)}function Gi(e,t){const n=ar(e,t);return t+=n.length,n===""?"":n+Wn(e,t)}const Hi=Xn([$i,Ki,Gi]);function Yi(e,t){var n;const s=e.substr(t).match(/^[01]+/);return(n=s&&s[0])!==null&&n!==void 0?n:""}function Xi(e,t){const n=e.substr(t,2);if(t+=n.length,n.toLowerCase()!=="0b")return"";const s=Yi(e,t);return s===""?"":n+s}function Wi(e,t){var n;const s=e.substr(t).match(/^[0-7]+/);return(n=s&&s[0])!==null&&n!==void 0?n:""}function Zi(e,t){const n=e.substr(t,2);if(t+=n.length,n.toLowerCase()!=="0o")return"";const s=Wi(e,t);return s===""?"":n+s}function Qi(e,t){var n;const s=e.substr(t).match(/^[0-9a-f]+/i);return(n=s&&s[0])!==null&&n!==void 0?n:""}function Ji(e,t){const n=e.substr(t,2);if(t+=n.length,n.toLowerCase()!=="0x")return"";const s=Qi(e,t);return s===""?"":n+s}const to=Xn([Xi,Zi,Ji]),eo=Xn([to,Hi]);function no(e,t){const n=eo(e,t);return t+=n.length,n===""?null:{evaluable:new Ri(n),cursor:t}}function so(e,t){const n=e.substr(t,1);if(t+=n.length,n!=="(")return null;const s=cr(e,t);if(!s)return null;t=s.cursor,t+=$e(e,t).length;const i=e.substr(t,1);return t+=i.length,i!==")"?null:{evaluable:s.evaluable,cursor:t}}function ro(e,t){var n;return(n=no(e,t))!==null&&n!==void 0?n:so(e,t)}function lr(e,t){const n=ro(e,t);if(n)return n;const s=e.substr(t,1);if(t+=s.length,s!=="+"&&s!=="-"&&s!=="~")return null;const i=lr(e,t);return i?(t=i.cursor,{cursor:t,evaluable:new Ni(s,i.evaluable)}):null}function io(e,t,n){n+=$e(t,n).length;const s=e.filter(i=>t.startsWith(i,n))[0];return s?(n+=s.length,n+=$e(t,n).length,{cursor:n,operator:s}):null}function oo(e,t){return(n,s)=>{const i=e(n,s);if(!i)return null;s=i.cursor;let u=i.evaluable;for(;;){const b=io(t,n,s);if(!b)break;s=b.cursor;const C=e(n,s);if(!C)return null;s=C.cursor,u=new ji(b.operator,u,C.evaluable)}return u?{cursor:s,evaluable:u}:null}}const ao=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((e,t)=>oo(e,t),lr);function cr(e,t){return t+=$e(e,t).length,ao(e,t)}function lo(e){const t=cr(e,0);return!t||t.cursor+$e(e,t.cursor).length!==e.length?null:t.evaluable}function ae(e){var t;const n=lo(e);return(t=n==null?void 0:n.evaluate())!==null&&t!==void 0?t:null}function ur(e){if(typeof e=="number")return e;if(typeof e=="string"){const t=ae(e);if(!ut(t))return t}return 0}function co(e){return String(e)}function It(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}function at(e,t,n,s,i){const u=(e-t)/(n-t);return s+u*(i-s)}function Os(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function wt(e,t,n){return Math.min(Math.max(e,t),n)}function pr(e,t){return(e%t+t)%t}function uo(e,t){return ut(e.step)?Math.max(Os(t),2):Os(e.step)}function dr(e){var t;return(t=e.step)!==null&&t!==void 0?t:1}function hr(e,t){var n;const s=Math.abs((n=e.step)!==null&&n!==void 0?n:t);return s===0?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}function vr(e,t){return ut(e.step)?null:new zi(e.step,t)}function fr(e){return!ut(e.max)&&!ut(e.min)?new We({max:e.max,min:e.min}):!ut(e.max)||!ut(e.min)?new Ti({max:e.max,min:e.min}):null}function mr(e,t){var n,s,i;return{formatter:(n=e.format)!==null&&n!==void 0?n:It(uo(e,t)),keyScale:(s=e.keyScale)!==null&&s!==void 0?s:dr(e),pointerScale:(i=e.pointerScale)!==null&&i!==void 0?i:hr(e,t)}}function br(e){return{format:e.optional.function,keyScale:e.optional.number,max:e.optional.number,min:e.optional.number,pointerScale:e.optional.number,step:e.optional.number}}function Zn(e){return{constraint:e.constraint,textProps:Q.fromObject(mr(e.params,e.initialValue))}}class Ee{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class Cn{constructor(t){this.target=t}}class Ze extends Cn{constructor(t,n,s){super(t),this.value=n,this.last=s??!0}}class po extends Cn{constructor(t,n){super(t),this.expanded=n}}class ho extends Cn{constructor(t,n){super(t),this.index=n}}class vo extends Cn{constructor(t,n){super(t),this.native=n}}class Ge extends Ee{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new ft,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,n){const s=n.bind(this);return this.emitter_.on(t,i=>{s(i)},{key:n}),this}off(t,n){return this.emitter_.off(t,n),this}refresh(){this.controller.value.fetch()}onValueChange_(t){const n=this.controller.value;this.emitter_.emit("change",new Ze(this,n.binding.target.read(),t.options.last))}}class fo{constructor(t,n){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=n,this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new ft}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,n){this.value_.setRawValue(t,n)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function mo(e){if(!("binding"in e))return!1;const t=e.binding;return Yn(t)&&"read"in t&&"write"in t}function bo(e,t){const s=Object.keys(t).reduce((i,u)=>{if(i===void 0)return;const b=t[u],C=b(e[u]);return C.succeeded?Object.assign(Object.assign({},i),{[u]:C.value}):void 0},{});return s}function wo(e,t){return e.reduce((n,s)=>{if(n===void 0)return;const i=t(s);if(!(!i.succeeded||i.value===void 0))return[...n,i.value]},[])}function _o(e){return e===null?!1:typeof e=="object"}function re(e){return t=>n=>{if(!t&&n===void 0)return{succeeded:!1,value:void 0};if(t&&n===void 0)return{succeeded:!0,value:void 0};const s=e(n);return s!==void 0?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function Ts(e){return{custom:t=>re(t)(e),boolean:re(t=>typeof t=="boolean"?t:void 0)(e),number:re(t=>typeof t=="number"?t:void 0)(e),string:re(t=>typeof t=="string"?t:void 0)(e),function:re(t=>typeof t=="function"?t:void 0)(e),constant:t=>re(n=>n===t?t:void 0)(e),raw:re(t=>t)(e),object:t=>re(n=>{if(_o(n))return bo(n,t)})(e),array:t=>re(n=>{if(Array.isArray(n))return wo(n,t)})(e)}}const In={optional:Ts(!0),required:Ts(!1)};function ht(e,t){const n=t(In),s=In.required.object(n)(e);return s.succeeded?s.value:void 0}function Gt(e,t,n,s){if(t&&!t(e))return!1;const i=ht(e,n);return i?s(i):!1}function Ht(e,t){var n;return ye((n=e==null?void 0:e())!==null&&n!==void 0?n:{},t)}function xe(e){return"value"in e}function wr(e){if(!Hn(e)||!("binding"in e))return!1;const t=e.binding;return Yn(t)}const ee="http://www.w3.org/2000/svg";function gn(e){e.offsetHeight}function go(e,t){const n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}function Qn(e){return e.ontouchstart!==void 0}function xo(){return globalThis}function yo(){return xo().document}function Po(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d",{willReadFrequently:!0}):null}const Co={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function En(e,t){const n=e.createElementNS(ee,"svg");return n.innerHTML=Co[t],n}function _r(e,t,n){e.insertBefore(t,e.children[n])}function Jn(e){e.parentElement&&e.parentElement.removeChild(e)}function gr(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function Eo(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}function xr(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}function oe(e,t){e.emitter.on("change",n=>{t(n.rawValue)}),t(e.rawValue)}function ne(e,t,n){oe(e.value(t),n)}const Mo="tp";function it(e){return(n,s)=>[Mo,"-",e,"v",n?`_${n}`:"",s?`-${s}`:""].join("")}const Ie=it("lbl");function ko(e,t){const n=e.createDocumentFragment();return t.split(`
`).map(i=>e.createTextNode(i)).forEach((i,u)=>{u>0&&n.appendChild(e.createElement("br")),n.appendChild(i)}),n}class yr{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Ie()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("div");s.classList.add(Ie("l")),ne(n.props,"label",u=>{ut(u)?this.element.classList.add(Ie(void 0,"nol")):(this.element.classList.remove(Ie(void 0,"nol")),Eo(s),s.appendChild(ko(t,u)))}),this.element.appendChild(s),this.labelElement=s;const i=t.createElement("div");i.classList.add(Ie("v")),this.element.appendChild(i),this.valueElement=i}}class Pr{constructor(t,n){this.props=n.props,this.valueController=n.valueController,this.viewProps=n.valueController.viewProps,this.view=new yr(t,{props:n.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return Gt(t,null,n=>({label:n.optional.string}),n=>(this.props.set("label",n.label),!0))}exportProps(){return Ht(null,{label:this.props.get("label")})}}function So(){return["veryfirst","first","last","verylast"]}const zs=it(""),Rs={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Mn{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const n=this.view.element;this.blade.value("positions").emitter.on("change",()=>{So().forEach(s=>{n.classList.remove(zs(void 0,Rs[s]))}),this.blade.get("positions").forEach(s=>{n.classList.add(zs(void 0,Rs[s]))})}),this.viewProps.handleDispose(()=>{Jn(n)})}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return Gt(t,null,n=>({disabled:n.required.boolean,hidden:n.required.boolean}),n=>(this.viewProps.importState(n),!0))}exportState(){return Ht(null,Object.assign({},this.viewProps.exportState()))}}class Pe extends Mn{constructor(t,n){if(n.value!==n.valueController.value)throw vt.shouldNeverHappen();const s=n.valueController.viewProps,i=new Pr(t,{blade:n.blade,props:n.props,valueController:n.valueController});super(Object.assign(Object.assign({},n),{view:new yr(t,{props:n.props,viewProps:s}),viewProps:s})),this.labelController=i,this.value=n.value,this.valueController=n.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return Gt(t,n=>{var s,i,u;return super.importState(n)&&this.labelController.importProps(n)&&((u=(i=(s=this.valueController).importProps)===null||i===void 0?void 0:i.call(s,t))!==null&&u!==void 0?u:!0)},n=>({value:n.optional.raw}),n=>(n.value&&(this.value.rawValue=n.value),!0))}exportState(){var t,n,s;return Ht(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(s=(n=(t=this.valueController).exportProps)===null||n===void 0?void 0:n.call(t))!==null&&s!==void 0?s:{}))}}function Is(e){const t=Object.assign({},e);return delete t.value,t}class Cr extends Pe{constructor(t,n){super(t,n),this.tag=n.tag}importState(t){return Gt(t,n=>super.importState(Is(t)),n=>({tag:n.optional.string}),n=>(this.tag=n.tag,!0))}exportState(){return Ht(()=>Is(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function Vo(e){return xe(e)&&wr(e.value)}class Do extends Cr{importState(t){return Gt(t,n=>super.importState(n),n=>({binding:n.required.object({value:n.required.raw})}),n=>(this.value.binding.inject(n.binding.value),this.value.fetch(),!0))}}function Ao(e){return xe(e)&&mo(e.value)}function Er(e,t){for(;e.length<t;)e.push(void 0)}function Bo(e){const t=[];return Er(t,e),t}function Lo(e){const t=e.indexOf(void 0);return t<0?e:e.slice(0,t)}function Oo(e,t){const n=[...Lo(e),t];return n.length>e.length?n.splice(0,n.length-e.length):Er(n,e.length),n}class To{constructor(t){this.emitter=new ft,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t.binding,this.value_=pt(Bo(t.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,n){this.value_.setRawValue(t,n)}fetch(){this.value_.rawValue=Oo(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function zo(e){if(!("binding"in e))return!1;const t=e.binding;return Yn(t)&&"read"in t&&!("write"in t)}class Ro extends Cr{exportState(){return Ht(()=>super.exportState(),{binding:{readonly:!0}})}}function Io(e){return xe(e)&&zo(e.value)}class jo extends Ee{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return(t=this.controller.buttonController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,n){const s=n.bind(this);return this.controller.buttonController.emitter.on(t,u=>{s(new vo(this,u.nativeEvent))}),this}off(t,n){return this.controller.buttonController.emitter.off(t,n),this}}function qo(e,t,n){n?e.classList.add(t):e.classList.remove(t)}function Oe(e,t){return n=>{qo(e,t,n)}}function ts(e,t){oe(e,n=>{t.textContent=n??""})}const Vn=it("btn");class No{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Vn()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("button");s.classList.add(Vn("b")),n.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const i=t.createElement("div");i.classList.add(Vn("t")),ts(n.props.value("title"),i),this.buttonElement.appendChild(i)}}class Fo{constructor(t,n){this.emitter=new ft,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new No(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return Gt(t,null,n=>({title:n.optional.string}),n=>(this.props.set("title",n.title),!0))}exportProps(){return Ht(null,{title:this.props.get("title")})}onClick_(t){this.emitter.emit("click",{nativeEvent:t,sender:this})}}class js extends Mn{constructor(t,n){const s=new Fo(t,{props:n.buttonProps,viewProps:n.viewProps}),i=new Pr(t,{blade:n.blade,props:n.labelProps,valueController:s});super({blade:n.blade,view:i.view,viewProps:n.viewProps}),this.buttonController=s,this.labelController=i}importState(t){return Gt(t,n=>super.importState(n)&&this.buttonController.importProps(n)&&this.labelController.importProps(n),()=>({}),()=>!0)}exportState(){return Ht(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class Mr{constructor(t){const[n,s]=t.split("-"),i=n.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=s??null}toString(){const t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}const Te=new Mr("2.0.4");function Ot(e){return Object.assign({core:Te},e)}const Uo=Ot({id:"button",type:"blade",accept(e){const t=ht(e,n=>({title:n.required.string,view:n.required.constant("button"),label:n.optional.string}));return t?{params:t}:null},controller(e){return new js(e.document,{blade:e.blade,buttonProps:Q.fromObject({title:e.params.title}),labelProps:Q.fromObject({label:e.params.label}),viewProps:e.viewProps})},api(e){return e.controller instanceof js?new jo(e.controller):null}});function $o(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function Ko(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function Go(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}function Ho(e){return Hn(e)?"refresh"in e&&typeof e.refresh=="function":!1}function Yo(e,t){if(!_n.isBindable(e))throw vt.notBindable();return new _n(e,t)}class Xo{constructor(t,n){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new ft,this.pool_=n,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(t=>this.pool_.createApi(t))}addBinding(t,n,s){const i=s??{},u=this.controller_.element.ownerDocument,b=this.pool_.createBinding(u,Yo(t,n),i),C=this.pool_.createBindingApi(b);return this.add(C,i.index)}addFolder(t){return Ko(this,t)}addButton(t){return $o(this,t)}addTab(t){return Go(this,t)}add(t,n){const s=t.controller;return this.controller_.rack.add(s,n),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){const n=this.controller_.element.ownerDocument,s=this.pool_.createBlade(n,t),i=this.pool_.createApi(s);return this.add(i,t.index)}on(t,n){const s=n.bind(this);return this.emitter_.on(t,i=>{s(i)},{key:n}),this}off(t,n){return this.emitter_.off(t,n),this}refresh(){this.children.forEach(t=>{Ho(t)&&t.refresh()})}onRackValueChange_(t){const n=t.bladeController,s=this.pool_.createApi(n),i=wr(n.value)?n.value.binding:null;this.emitter_.emit("change",new Ze(s,i?i.target.read():n.value.rawValue,t.options.last))}}class es extends Ee{constructor(t,n){super(t),this.rackApi_=new Xo(t.rackController,n)}refresh(){this.rackApi_.refresh()}}class ns extends Mn{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return Gt(t,n=>super.importState(n),n=>({children:n.required.array(n.required.raw)}),n=>this.rackController.rack.children.every((s,i)=>s.importState(n.children[i])))}exportState(){return Ht(()=>super.exportState(),{children:this.rackController.rack.children.map(t=>t.exportState())})}}function jn(e){return"rackController"in e}class Wo{constructor(t){this.emitter=new ft,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const n of this.allItems())if(t(n))return n;return null}includes(t){return this.cache_.has(t)}add(t,n){if(this.includes(t))throw vt.shouldNeverHappen();const s=n!==void 0?n:this.items_.length;this.items_.splice(s,0,t),this.cache_.add(t);const i=this.extract_(t);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach(u=>{this.cache_.add(u)})),this.emitter.emit("add",{index:s,item:t,root:this,target:this})}remove(t){const n=this.items_.indexOf(t);if(n<0)return;this.items_.splice(n,1),this.cache_.delete(t);const s=this.extract_(t);s&&(s.allItems().forEach(i=>{this.cache_.delete(i)}),s.emitter.off("add",this.onSubListAdd_),s.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:n,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function Zo(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(xe(s)&&s.value===t)return s}return null}function Qo(e){return jn(e)?e.rackController.rack.bcSet_:null}class Jo{constructor(t){var n,s;this.emitter=new ft,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(n=t.blade)!==null&&n!==void 0?n:null,(s=this.blade_)===null||s===void 0||s.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new Wo(Qo),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,n){var s;(s=t.parent)===null||s===void 0||s.remove(t),t.parent=this,this.bcSet_.add(t,n)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();const n=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:n,sender:this}),!n)return;const s=t.item;if(s.viewProps.emitter.on("change",this.onChildViewPropsChange_),s.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),s.viewProps.handleDispose(this.onChildDispose_),xe(s))s.value.emitter.on("change",this.onChildValueChange_);else if(jn(s)){const i=s.rackController.rack;if(i){const u=i.emitter;u.on("layout",this.onRackLayout_),u.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();const n=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:n,sender:this}),!n)return;const s=t.item;if(xe(s))s.value.emitter.off("change",this.onChildValueChange_);else if(jn(s)){const i=s.rackController.rack;if(i){const u=i.emitter;u.off("layout",this.onRackLayout_),u.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const t=this.bcSet_.items.filter(i=>!i.viewProps.get("hidden")),n=t[0],s=t[t.length-1];this.bcSet_.items.forEach(i=>{const u=[];i===n&&(u.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&u.push("veryfirst")),i===s&&(u.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&u.push("verylast")),i.blade.set("positions",u)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(n=>n.viewProps.get("disposed")).forEach(n=>{this.bcSet_.remove(n)})}onChildValueChange_(t){const n=Zo(this.find(xe),t.sender);if(!n)throw vt.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:n,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class ss{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;const n=new Jo({blade:t.root?void 0:t.blade,viewProps:t.viewProps});n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose(()=>{for(let s=this.rack.children.length-1;s>=0;s--)this.rack.children[s].viewProps.set("disposed",!0)})}onRackAdd_(t){t.root&&_r(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&Jn(t.bladeController.view.element)}}function ze(){return new Q({positions:pt([],{equals:Vi})})}class Qe extends Q{constructor(t){super(t)}static create(t){const n={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},s=Q.createCore(n);return new Qe(s)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!ut(t)?`${t}px`:"auto"}bindExpandedClass(t,n){const s=()=>{this.styleExpanded?t.classList.add(n):t.classList.remove(n)};ne(this,"expanded",s),ne(this,"temporaryExpanded",s)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function ta(e,t){let n=0;return go(t,()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),gn(t),n=t.clientHeight,e.set("temporaryExpanded",null),gn(t)}),n}function qs(e,t){t.style.height=e.styleHeight}function rs(e,t){e.value("expanded").emitter.on("beforechange",()=>{if(e.set("completed",!1),ut(e.get("expandedHeight"))){const n=ta(e,t);n>0&&e.set("expandedHeight",n)}e.set("shouldFixHeight",!0),gn(t)}),e.emitter.on("change",()=>{qs(e,t)}),qs(e,t),t.addEventListener("transitionend",n=>{n.propertyName==="height"&&e.cleanUpTransition()})}class kr extends es{constructor(t,n){super(t,n),this.emitter_=new ft,this.controller.foldable.value("expanded").emitter.on("change",s=>{this.emitter_.emit("fold",new po(this,s.sender.rawValue))}),this.rackApi_.on("change",s=>{this.emitter_.emit("change",s)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,n,s){return this.rackApi_.addBinding(t,n,s)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,n){return this.rackApi_.add(t,n)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,n){const s=n.bind(this);return this.emitter_.on(t,i=>{s(i)},{key:n}),this}off(t,n){return this.emitter_.off(t,n),this}}const Sr=it("cnt");class ea{constructor(t,n){var s;this.className_=it((s=n.viewName)!==null&&s!==void 0?s:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),Sr()),n.viewProps.bindClassModifiers(this.element),this.foldable_=n.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ne(this.foldable_,"completed",Oe(this.element,this.className_(void 0,"cpl")));const i=t.createElement("button");i.classList.add(this.className_("b")),ne(n.props,"title",T=>{ut(T)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),n.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const u=t.createElement("div");u.classList.add(this.className_("i")),this.element.appendChild(u);const b=t.createElement("div");b.classList.add(this.className_("t")),ts(n.props.value("title"),b),this.buttonElement.appendChild(b),this.titleElement=b;const C=t.createElement("div");C.classList.add(this.className_("m")),this.buttonElement.appendChild(C);const O=t.createElement("div");O.classList.add(this.className_("c")),this.element.appendChild(O),this.containerElement=O}}class qn extends ns{constructor(t,n){var s;const i=Qe.create((s=n.expanded)!==null&&s!==void 0?s:!0),u=new ea(t,{foldable:i,props:n.props,viewName:n.root?"rot":void 0,viewProps:n.viewProps});super(Object.assign(Object.assign({},n),{rackController:new ss({blade:n.blade,element:u.containerElement,root:n.root,viewProps:n.viewProps}),view:u})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=n.props,this.foldable=i,rs(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return Gt(t,n=>super.importState(n),n=>({expanded:n.required.boolean,title:n.optional.string}),n=>(this.foldable.set("expanded",n.expanded),this.props.set("title",n.title),!0))}exportState(){return Ht(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const na=Ot({id:"folder",type:"blade",accept(e){const t=ht(e,n=>({title:n.required.string,view:n.required.constant("folder"),expanded:n.optional.boolean}));return t?{params:t}:null},controller(e){return new qn(e.document,{blade:e.blade,expanded:e.params.expanded,props:Q.fromObject({title:e.params.title}),viewProps:e.viewProps})},api(e){return e.controller instanceof qn?new kr(e.controller,e.pool):null}}),sa=it("");function Ns(e,t){return Oe(e,sa(void 0,t))}class ce extends Q{constructor(t){var n;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=Oi(pt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(n=this.get("parent"))===null||n===void 0||n.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var n,s,i;const u=t??{};return new ce(Q.createCore({disabled:(n=u.disabled)!==null&&n!==void 0?n:!1,disposed:!1,hidden:(s=u.hidden)!==null&&s!==void 0?s:!1,parent:(i=u.parent)!==null&&i!==void 0?i:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){oe(this.globalDisabled_,Ns(t,"disabled")),ne(this,"hidden",Ns(t,"hidden"))}bindDisabled(t){oe(this.globalDisabled_,n=>{t.disabled=n})}bindTabIndex(t){oe(this.globalDisabled_,n=>{t.tabIndex=n?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",n=>{n&&t()})}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const t=this.get("parent");return(t?t.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var n;const s=t.previousRawValue;s==null||s.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(n=this.get("parent"))===null||n===void 0||n.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Fs=it("tbp");class ra{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Fs()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("div");s.classList.add(Fs("c")),this.element.appendChild(s),this.containerElement=s}}const je=it("tbi");class ia{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(je()),n.viewProps.bindClassModifiers(this.element),ne(n.props,"selected",u=>{u?this.element.classList.add(je(void 0,"sel")):this.element.classList.remove(je(void 0,"sel"))});const s=t.createElement("button");s.classList.add(je("b")),n.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const i=t.createElement("div");i.classList.add(je("t")),ts(n.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class oa{constructor(t,n){this.emitter=new ft,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new ia(t,{props:n.props,viewProps:n.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Nn extends ns{constructor(t,n){const s=new ra(t,{viewProps:n.viewProps});super(Object.assign(Object.assign({},n),{rackController:new ss({blade:n.blade,element:s.containerElement,viewProps:n.viewProps}),view:s})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new oa(t,{props:n.itemProps,viewProps:ce.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=n.props,ne(this.props,"selected",i=>{this.itemController.props.set("selected",i),this.viewProps.set("hidden",!i)})}get itemController(){return this.ic_}importState(t){return Gt(t,n=>super.importState(n),n=>({selected:n.required.boolean,title:n.required.string}),n=>(this.ic_.props.set("selected",n.selected),this.ic_.props.set("title",n.title),!0))}exportState(){return Ht(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class aa extends es{constructor(t,n){super(t,n),this.emitter_=new ft,this.onSelect_=this.onSelect_.bind(this),this.pool_=n,this.rackApi_.on("change",s=>{this.emitter_.emit("change",s)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){const n=this.controller.view.element.ownerDocument,s=new Nn(n,{blade:ze(),itemProps:Q.fromObject({selected:!1,title:t.title}),props:Q.fromObject({selected:!1}),viewProps:ce.create()}),i=this.pool_.createApi(s);return this.rackApi_.add(i,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,n){const s=n.bind(this);return this.emitter_.on(t,i=>{s(i)},{key:n}),this}off(t,n){return this.emitter_.off(t,n),this}onSelect_(t){this.emitter_.emit("select",new ho(this,t.rawValue))}}class la extends es{get title(){var t;return(t=this.controller.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,n){this.rackApi_.add(t,n)}remove(t){this.rackApi_.remove(t)}addBinding(t,n,s){return this.rackApi_.addBinding(t,n,s)}addBlade(t){return this.rackApi_.addBlade(t)}}const Us=-1;class ca{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=pt(!0),this.selectedIndex=pt(Us),this.items_=[]}add(t,n){const s=n??this.items_.length;this.items_.splice(s,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const n=this.items_.indexOf(t);n<0||(this.items_.splice(n,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Us,this.empty.rawValue=!0;return}const t=this.items_.findIndex(n=>n.rawValue);t<0?(this.items_.forEach((n,s)=>{n.rawValue=s===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((n,s)=>{n.rawValue=s===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const n=this.items_.findIndex(s=>s===t.sender);this.items_.forEach((s,i)=>{s.rawValue=i===n}),this.selectedIndex.rawValue=n}else this.keepSelection_()}}const qe=it("tab");class ua{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(qe(),Sr()),n.viewProps.bindClassModifiers(this.element),oe(n.empty,Oe(this.element,qe(void 0,"nop")));const s=t.createElement("div");s.classList.add(qe("t")),this.element.appendChild(s),this.itemsElement=s;const i=t.createElement("div");i.classList.add(qe("i")),this.element.appendChild(i);const u=t.createElement("div");u.classList.add(qe("c")),this.element.appendChild(u),this.contentsElement=u}}class $s extends ns{constructor(t,n){const s=new ca,i=new ua(t,{empty:s.empty,viewProps:n.viewProps});super({blade:n.blade,rackController:new ss({blade:n.blade,element:i.contentsElement,viewProps:n.viewProps}),view:i}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const u=this.rackController.rack;u.emitter.on("add",this.onRackAdd_),u.emitter.on("remove",this.onRackRemove_),this.tab=s}add(t,n){this.rackController.rack.add(t,n)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;const n=t.bladeController;_r(this.view.itemsElement,n.itemController.view.element,t.index),n.itemController.viewProps.set("parent",this.viewProps),this.tab.add(n.props.value("selected"))}onRackRemove_(t){if(!t.root)return;const n=t.bladeController;Jn(n.itemController.view.element),n.itemController.viewProps.set("parent",null),this.tab.remove(n.props.value("selected"))}}const Vr=Ot({id:"tab",type:"blade",accept(e){const t=ht(e,n=>({pages:n.required.array(n.required.object({title:n.required.string})),view:n.required.constant("tab")}));return!t||t.pages.length===0?null:{params:t}},controller(e){const t=new $s(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach(n=>{const s=new Nn(e.document,{blade:ze(),itemProps:Q.fromObject({selected:!1,title:n.title}),props:Q.fromObject({selected:!1}),viewProps:ce.create()});t.add(s)}),t},api(e){return e.controller instanceof $s?new aa(e.controller,e.pool):e.controller instanceof Nn?new la(e.controller,e.pool):null}});function pa(e,t){const n=e.accept(t.params);if(!n)return null;const s=ht(t.params,i=>({disabled:i.optional.boolean,hidden:i.optional.boolean}));return e.controller({blade:ze(),document:t.document,params:Object.assign(Object.assign({},n.params),{disabled:s==null?void 0:s.disabled,hidden:s==null?void 0:s.hidden}),viewProps:ce.create({disabled:s==null?void 0:s.disabled,hidden:s==null?void 0:s.hidden})})}class is extends Ge{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class da{constructor(){this.disabled=!1,this.emitter=new ft}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class ha{constructor(t,n){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new ft,this.interval_=n,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Je{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((n,s)=>s.constrain(n),t)}}function xn(e,t){if(e instanceof t)return e;if(e instanceof Je){const n=e.constraints.reduce((s,i)=>s||(i instanceof t?i:null),null);if(n)return n}return null}class tn{constructor(t){this.values=Q.fromObject({options:t})}constrain(t){const n=this.values.get("options");return n.length===0||n.filter(i=>i.value===t).length>0?t:n[0].value}}function en(e){var t;const n=In;if(Array.isArray(e))return(t=ht({items:e},s=>({items:s.required.array(s.required.object({text:s.required.string,value:s.required.raw}))})))===null||t===void 0?void 0:t.items;if(typeof e=="object")return n.required.raw(e).value}function os(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach(n=>{t.push({text:n,value:e[n]})}),t}function as(e){return ut(e)?null:new tn(os(e))}const Dn=it("lst");class va{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.props_=n.props,this.element=t.createElement("div"),this.element.classList.add(Dn()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("select");s.classList.add(Dn("s")),n.viewProps.bindDisabled(s),this.element.appendChild(s),this.selectElement=s;const i=t.createElement("div");i.classList.add(Dn("m")),i.appendChild(En(t,"dropdown")),this.element.appendChild(i),n.value.emitter.on("change",this.onValueChange_),this.value_=n.value,ne(this.props_,"options",u=>{gr(this.selectElement),u.forEach(b=>{const C=t.createElement("option");C.textContent=b.text,this.selectElement.appendChild(C)}),this.update_()})}update_(){const t=this.props_.get("options").map(n=>n.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class be{constructor(t,n){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new va(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const n=t.currentTarget;this.value.rawValue=this.props.get("options")[n.selectedIndex].value}importProps(t){return Gt(t,null,n=>({options:n.required.custom(en)}),n=>(this.props.set("options",os(n.options)),!0))}exportProps(){return Ht(null,{options:this.props.get("options")})}}const Ks=it("pop");class fa{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Ks()),n.viewProps.bindClassModifiers(this.element),oe(n.shows,Oe(this.element,Ks(void 0,"v")))}}class Dr{constructor(t,n){this.shows=pt(!1),this.viewProps=n.viewProps,this.view=new fa(t,{shows:this.shows,viewProps:this.viewProps})}}const Gs=it("txt");class ma{constructor(t,n){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Gs()),n.viewProps.bindClassModifiers(this.element),this.props_=n.props,this.props_.emitter.on("change",this.onChange_);const s=t.createElement("input");s.classList.add(Gs("i")),s.type="text",n.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,n.value.emitter.on("change",this.onChange_),this.value_=n.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class He{constructor(t,n){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=n.parser,this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new ma(t,{props:n.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const s=t.currentTarget.value,i=this.parser_(s);ut(i)||(this.value.rawValue=i),this.view.refresh()}}function ba(e){return String(e)}function Ar(e){return e==="false"?!1:!!e}function Hs(e){return ba(e)}function wa(e){return t=>e.reduce((n,s)=>n!==null?n:s(t),null)}const _a=It(0);function yn(e){return _a(e)+"%"}function Br(e){return String(e)}function Fn(e){return e}function Re({primary:e,secondary:t,forward:n,backward:s}){let i=!1;function u(b){i||(i=!0,b(),i=!1)}e.emitter.on("change",b=>{u(()=>{t.setRawValue(n(e.rawValue,t.rawValue),b.options)})}),t.emitter.on("change",b=>{u(()=>{e.setRawValue(s(e.rawValue,t.rawValue),b.options)}),u(()=>{t.setRawValue(n(e.rawValue,t.rawValue),b.options)})}),u(()=>{t.setRawValue(n(e.rawValue,t.rawValue),{forceEmit:!1,last:!0})})}function Rt(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function Ye(e){return{altKey:e.altKey,downKey:e.key==="ArrowDown",shiftKey:e.shiftKey,upKey:e.key==="ArrowUp"}}function le(e){return{altKey:e.altKey,downKey:e.key==="ArrowLeft",shiftKey:e.shiftKey,upKey:e.key==="ArrowRight"}}function ga(e){return e==="ArrowUp"||e==="ArrowDown"}function Lr(e){return ga(e)||e==="ArrowLeft"||e==="ArrowRight"}function An(e,t){var n,s;const i=t.ownerDocument.defaultView,u=t.getBoundingClientRect();return{x:e.pageX-(((n=i&&i.scrollX)!==null&&n!==void 0?n:0)+u.left),y:e.pageY-(((s=i&&i.scrollY)!==null&&s!==void 0?s:0)+u.top)}}class Me{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new ft,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const n=this.elem_.getBoundingClientRect();return{bounds:{width:n.width,height:n.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var n;t.preventDefault(),(n=t.currentTarget)===null||n===void 0||n.focus();const s=this.elem_.ownerDocument;s.addEventListener("mousemove",this.onDocumentMouseMove_),s.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(An(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(An(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const n=this.elem_.ownerDocument;n.removeEventListener("mousemove",this.onDocumentMouseMove_),n.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(An(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const n=t.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-s.left,y:n.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=n}onTouchMove_(t){const n=t.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-s.left,y:n.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=n}onTouchEnd_(t){var n;const s=(n=t.targetTouches.item(0))!==null&&n!==void 0?n:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(s?{x:s.clientX-i.left,y:s.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey})}}const Xt=it("txt");class xa{constructor(t,n){this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Xt(),Xt(void 0,"num")),n.arrayPosition&&this.element.classList.add(Xt(void 0,n.arrayPosition)),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("input");s.classList.add(Xt("i")),s.type="text",n.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=n.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Xt()),this.inputElement.classList.add(Xt("i"));const i=t.createElement("div");i.classList.add(Xt("k")),this.element.appendChild(i),this.knobElement=i;const u=t.createElementNS(ee,"svg");u.classList.add(Xt("g")),this.knobElement.appendChild(u);const b=t.createElementNS(ee,"path");b.classList.add(Xt("gb")),u.appendChild(b),this.guideBodyElem_=b;const C=t.createElementNS(ee,"path");C.classList.add(Xt("gh")),u.appendChild(C),this.guideHeadElem_=C;const O=t.createElement("div");O.classList.add(it("tt")()),this.knobElement.appendChild(O),this.tooltipElem_=O,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(Xt(void 0,"drg"));return}this.element.classList.add(Xt(void 0,"drg"));const n=t.rawValue/this.props_.get("pointerScale"),s=n+(n>0?-1:n<0?1:0),i=wt(-s,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${s+i},0 L${s},4 L${s+i},8`,`M ${n},-1 L${n},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${n},4`);const u=this.props_.get("formatter");this.tooltipElem_.textContent=u(this.value.rawValue),this.tooltipElem_.style.left=`${n}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class nn{constructor(t,n){var s;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=n.parser,this.props=n.props,this.sliderProps_=(s=n.sliderProps)!==null&&s!==void 0?s:null,this.value=n.value,this.viewProps=n.viewProps,this.dragging_=pt(null),this.view=new xa(t,{arrayPosition:n.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new Me(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var n,s;const i=(n=this.sliderProps_)===null||n===void 0?void 0:n.get("min"),u=(s=this.sliderProps_)===null||s===void 0?void 0:s.get("max");let b=t;return i!==void 0&&(b=Math.max(b,i)),u!==void 0&&(b=Math.min(b,u)),b}onInputChange_(t){const s=t.currentTarget.value,i=this.parser_(s);ut(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){const n=Rt(this.props.get("keyScale"),Ye(t));n!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+n),{forceEmit:!1,last:!1})}onInputKeyUp_(t){Rt(this.props.get("keyScale"),Ye(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const n=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+n*this.props.get("pointerScale"))}onPointerMove_(t){const n=this.computeDraggingValue_(t.data);n!==null&&(this.value.setRawValue(n,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const n=this.computeDraggingValue_(t.data);n!==null&&(this.value.setRawValue(n,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Bn=it("sld");class ya{constructor(t,n){this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Bn()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("div");s.classList.add(Bn("t")),n.viewProps.bindTabIndex(s),this.element.appendChild(s),this.trackElement=s;const i=t.createElement("div");i.classList.add(Bn("k")),this.trackElement.appendChild(i),this.knobElement=i,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.update_()}update_(){const t=wt(at(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class Pa{constructor(t,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.props=n.props,this.view=new ya(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Me(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,n){t.point&&this.value.setRawValue(at(wt(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),n)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const n=Rt(this.props.get("keyScale"),le(t));n!==0&&this.value.setRawValue(this.value.rawValue+n,{forceEmit:!1,last:!1})}onKeyUp_(t){Rt(this.props.get("keyScale"),le(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ln=it("sldtxt");class Ca{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Ln());const s=t.createElement("div");s.classList.add(Ln("s")),this.sliderView_=n.sliderView,s.appendChild(this.sliderView_.element),this.element.appendChild(s);const i=t.createElement("div");i.classList.add(Ln("t")),this.textView_=n.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class Pn{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.sliderC_=new Pa(t,{props:n.sliderProps,value:n.value,viewProps:this.viewProps}),this.textC_=new nn(t,{parser:n.parser,props:n.textProps,sliderProps:n.sliderProps,value:n.value,viewProps:n.viewProps}),this.view=new Ca(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return Gt(t,null,n=>({max:n.required.number,min:n.required.number}),n=>{const s=this.sliderC_.props;return s.set("max",n.max),s.set("min",n.min),!0})}exportProps(){const t=this.sliderC_.props;return Ht(null,{max:t.get("max"),min:t.get("min")})}}function Or(e){return{sliderProps:new Q({keyScale:e.keyScale,max:e.max,min:e.min}),textProps:new Q({formatter:pt(e.formatter),keyScale:e.keyScale,pointerScale:pt(e.pointerScale)})}}const Ea={containerUnitSize:"cnt-usz"};function Tr(e){return`--${Ea[e]}`}function Xe(e){return br(e)}function fe(e){if(Rn(e))return ht(e,Xe)}function ie(e,t){if(!e)return;const n=[],s=vr(e,t);s&&n.push(s);const i=fr(e);return i&&n.push(i),new Je(n)}function Ma(e){return e?e.major===Te.major:!1}function zr(e){if(e==="inline"||e==="popup")return e}function sn(e,t){e.write(t)}const fn=it("ckb");class ka{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(fn()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("label");s.classList.add(fn("l")),this.element.appendChild(s),this.labelElement=s;const i=t.createElement("input");i.classList.add(fn("i")),i.type="checkbox",this.labelElement.appendChild(i),this.inputElement=i,n.viewProps.bindDisabled(this.inputElement);const u=t.createElement("div");u.classList.add(fn("w")),this.labelElement.appendChild(u);const b=En(t,"check");u.appendChild(b),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Sa{constructor(t,n){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new ka(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(t){const n=t.currentTarget;this.value.rawValue=n.checked,t.preventDefault(),t.stopPropagation()}onLabelMouseDown_(t){t.preventDefault()}}function Va(e){const t=[],n=as(e.options);return n&&t.push(n),new Je(t)}const Da=Ot({id:"input-bool",type:"input",accept:(e,t)=>{if(typeof e!="boolean")return null;const n=ht(t,s=>({options:s.optional.custom(en),readonly:s.optional.constant(!1)}));return n?{initialValue:e,params:n}:null},binding:{reader:e=>Ar,constraint:e=>Va(e.params),writer:e=>sn},controller:e=>{const t=e.document,n=e.value,s=e.constraint,i=s&&xn(s,tn);return i?new be(t,{props:new Q({options:i.values.value("options")}),value:n,viewProps:e.viewProps}):new Sa(t,{value:n,viewProps:e.viewProps})},api(e){return typeof e.controller.value.rawValue!="boolean"?null:e.controller.valueController instanceof be?new is(e.controller):null}}),we=it("col");class Aa{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(we()),n.foldable.bindExpandedClass(this.element,we(void 0,"expanded")),ne(n.foldable,"completed",Oe(this.element,we(void 0,"cpl")));const s=t.createElement("div");s.classList.add(we("h")),this.element.appendChild(s);const i=t.createElement("div");i.classList.add(we("s")),s.appendChild(i),this.swatchElement=i;const u=t.createElement("div");if(u.classList.add(we("t")),s.appendChild(u),this.textElement=u,n.pickerLayout==="inline"){const b=t.createElement("div");b.classList.add(we("p")),this.element.appendChild(b),this.pickerElement=b}else this.pickerElement=null}}function Ba(e,t,n){const s=wt(e/255,0,1),i=wt(t/255,0,1),u=wt(n/255,0,1),b=Math.max(s,i,u),C=Math.min(s,i,u),O=b-C;let T=0,N=0;const L=(C+b)/2;return O!==0&&(N=O/(1-Math.abs(b+C-1)),s===b?T=(i-u)/O:i===b?T=2+(u-s)/O:T=4+(s-i)/O,T=T/6+(T<0?1:0)),[T*360,N*100,L*100]}function La(e,t,n){const s=(e%360+360)%360,i=wt(t/100,0,1),u=wt(n/100,0,1),b=(1-Math.abs(2*u-1))*i,C=b*(1-Math.abs(s/60%2-1)),O=u-b/2;let T,N,L;return s>=0&&s<60?[T,N,L]=[b,C,0]:s>=60&&s<120?[T,N,L]=[C,b,0]:s>=120&&s<180?[T,N,L]=[0,b,C]:s>=180&&s<240?[T,N,L]=[0,C,b]:s>=240&&s<300?[T,N,L]=[C,0,b]:[T,N,L]=[b,0,C],[(T+O)*255,(N+O)*255,(L+O)*255]}function Oa(e,t,n){const s=wt(e/255,0,1),i=wt(t/255,0,1),u=wt(n/255,0,1),b=Math.max(s,i,u),C=Math.min(s,i,u),O=b-C;let T;O===0?T=0:b===s?T=60*(((i-u)/O%6+6)%6):b===i?T=60*((u-s)/O+2):T=60*((s-i)/O+4);const N=b===0?0:O/b,L=b;return[T,N*100,L*100]}function Rr(e,t,n){const s=pr(e,360),i=wt(t/100,0,1),u=wt(n/100,0,1),b=u*i,C=b*(1-Math.abs(s/60%2-1)),O=u-b;let T,N,L;return s>=0&&s<60?[T,N,L]=[b,C,0]:s>=60&&s<120?[T,N,L]=[C,b,0]:s>=120&&s<180?[T,N,L]=[0,b,C]:s>=180&&s<240?[T,N,L]=[0,C,b]:s>=240&&s<300?[T,N,L]=[C,0,b]:[T,N,L]=[b,0,C],[(T+O)*255,(N+O)*255,(L+O)*255]}function Ta(e,t,n){const s=n+t*(100-Math.abs(2*n-100))/200;return[e,s!==0?t*(100-Math.abs(2*n-100))/s:0,n+t*(100-Math.abs(2*n-100))/(2*100)]}function za(e,t,n){const s=100-Math.abs(n*(200-t)/100-100);return[e,s!==0?t*n/s:0,n*(200-t)/(2*100)]}function se(e){return[e[0],e[1],e[2]]}function kn(e,t){return[e[0],e[1],e[2],t]}const Ra={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:Ta,rgb:La},hsv:{hsl:za,hsv:(e,t,n)=>[e,t,n],rgb:Rr},rgb:{hsl:Ba,hsv:Oa,rgb:(e,t,n)=>[e,t,n]}};function Le(e,t){return[t==="float"?1:e==="rgb"?255:360,t==="float"?1:e==="rgb"?255:100,t==="float"?1:e==="rgb"?255:100]}function Ia(e,t){return e===t?t:pr(e,t)}function Ir(e,t,n){var s;const i=Le(t,n);return[t==="rgb"?wt(e[0],0,i[0]):Ia(e[0],i[0]),wt(e[1],0,i[1]),wt(e[2],0,i[2]),wt((s=e[3])!==null&&s!==void 0?s:1,0,1)]}function Ys(e,t,n,s){const i=Le(t,n),u=Le(t,s);return e.map((b,C)=>b/i[C]*u[C])}function jr(e,t,n){const s=Ys(e,t.mode,t.type,"int"),i=Ra[t.mode][n.mode](...s);return Ys(i,n.mode,"int",n.type)}class ot{static black(){return new ot([0,0,0],"rgb")}constructor(t,n){this.type="int",this.mode=n,this.comps_=Ir(t,n,this.type)}getComponents(t){return kn(jr(se(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const ue=it("colp");class ja{constructor(t,n){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(ue()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("div");s.classList.add(ue("hsv"));const i=t.createElement("div");i.classList.add(ue("sv")),this.svPaletteView_=n.svPaletteView,i.appendChild(this.svPaletteView_.element),s.appendChild(i);const u=t.createElement("div");u.classList.add(ue("h")),this.hPaletteView_=n.hPaletteView,u.appendChild(this.hPaletteView_.element),s.appendChild(u),this.element.appendChild(s);const b=t.createElement("div");if(b.classList.add(ue("rgb")),this.textsView_=n.textsView,b.appendChild(this.textsView_.element),this.element.appendChild(b),n.alphaViews){this.alphaViews_={palette:n.alphaViews.palette,text:n.alphaViews.text};const C=t.createElement("div");C.classList.add(ue("a"));const O=t.createElement("div");O.classList.add(ue("ap")),O.appendChild(this.alphaViews_.palette.element),C.appendChild(O);const T=t.createElement("div");T.classList.add(ue("at")),T.appendChild(this.alphaViews_.text.element),C.appendChild(T),this.element.appendChild(C)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(n=>n.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function qa(e){return e==="int"?"int":e==="float"?"float":void 0}function ls(e){return ht(e,t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(qa)}),expanded:t.optional.boolean,picker:t.optional.custom(zr),readonly:t.optional.constant(!1)}))}function Ce(e){return e?.1:1}function qr(e){var t;return(t=e.color)===null||t===void 0?void 0:t.type}class cs{constructor(t,n){this.type="float",this.mode=n,this.comps_=Ir(t,n,this.type)}getComponents(t){return kn(jr(se(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Na={int:(e,t)=>new ot(e,t),float:(e,t)=>new cs(e,t)};function us(e,t,n){return Na[n](e,t)}function Fa(e){return e.type==="float"}function Ua(e){return e.type==="int"}function $a(e){const t=e.getComponents(),n=Le(e.mode,"int");return new ot([Math.round(at(t[0],0,1,0,n[0])),Math.round(at(t[1],0,1,0,n[1])),Math.round(at(t[2],0,1,0,n[2])),t[3]],e.mode)}function Ka(e){const t=e.getComponents(),n=Le(e.mode,"int");return new cs([at(t[0],0,n[0],0,1),at(t[1],0,n[1],0,1),at(t[2],0,n[2],0,1),t[3]],e.mode)}function Lt(e,t){if(e.type===t)return e;if(Ua(e)&&t==="float")return Ka(e);if(Fa(e)&&t==="int")return $a(e);throw vt.shouldNeverHappen()}function Ga(e,t){return e.alpha===t.alpha&&e.mode===t.mode&&e.notation===t.notation&&e.type===t.type}function Zt(e,t){const n=e.match(/^(.+)%$/);return Math.min(n?parseFloat(n[1])*.01*t:parseFloat(e),t)}const Ha={deg:e=>e,grad:e=>e*360/400,rad:e=>e*360/(2*Math.PI),turn:e=>e*360};function Nr(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]),s=t[2];return Ha[s](n)}function Fr(e){const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Zt(t[1],255),Zt(t[2],255),Zt(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Ya(e){const t=Fr(e);return t?new ot(t,"rgb"):null}function Ur(e){const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Zt(t[1],255),Zt(t[2],255),Zt(t[3],255),Zt(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Xa(e){const t=Ur(e);return t?new ot(t,"rgb"):null}function $r(e){const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Nr(t[1]),Zt(t[2],100),Zt(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Wa(e){const t=$r(e);return t?new ot(t,"hsl"):null}function Kr(e){const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Nr(t[1]),Zt(t[2],100),Zt(t[3],100),Zt(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Za(e){const t=Kr(e);return t?new ot(t,"hsl"):null}function Gr(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function Qa(e){const t=Gr(e);return t?new ot(t,"rgb"):null}function Hr(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),at(parseInt(t[4]+t[4],16),0,255,0,1)];const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),at(parseInt(n[4],16),0,255,0,1)]:null}function Ja(e){const t=Hr(e);return t?new ot(t,"rgb"):null}function Yr(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function tl(e){return t=>{const n=Yr(t);return n?us(n,"rgb",e):null}}function Xr(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function el(e){return t=>{const n=Xr(t);return n?us(n,"rgb",e):null}}const nl=[{parser:Gr,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Hr,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Fr,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Ur,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:$r,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Kr,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Yr,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Xr,result:{alpha:!0,mode:"rgb",notation:"object"}}];function sl(e){return nl.reduce((t,{parser:n,result:s})=>t||(n(e)?s:null),null)}function rl(e,t="int"){const n=sl(e);return n?n.notation==="hex"&&t!=="float"?Object.assign(Object.assign({},n),{type:"int"}):n.notation==="func"?Object.assign(Object.assign({},n),{type:t}):null:null}function rn(e){const t=[Qa,Ja,Ya,Xa,Wa,Za];t.push(tl("int"),el("int"));const n=wa(t);return s=>{const i=n(s);return i?Lt(i,e):null}}function il(e){const t=rn("int");if(typeof e!="string")return ot.black();const n=t(e);return n??ot.black()}function Wr(e){const t=wt(Math.floor(e),0,255).toString(16);return t.length===1?`0${t}`:t}function ps(e,t="#"){const n=se(e.getComponents("rgb")).map(Wr).join("");return`${t}${n}`}function ds(e,t="#"){const n=e.getComponents("rgb"),s=[n[0],n[1],n[2],n[3]*255].map(Wr).join("");return`${t}${s}`}function Zr(e){const t=It(0),n=Lt(e,"int");return`rgb(${se(n.getComponents("rgb")).map(i=>t(i)).join(", ")})`}function bn(e){const t=It(2),n=It(0);return`rgba(${Lt(e,"int").getComponents("rgb").map((u,b)=>(b===3?t:n)(u)).join(", ")})`}function ol(e){const t=[It(0),yn,yn],n=Lt(e,"int");return`hsl(${se(n.getComponents("hsl")).map((i,u)=>t[u](i)).join(", ")})`}function al(e){const t=[It(0),yn,yn,It(2)];return`hsla(${Lt(e,"int").getComponents("hsl").map((i,u)=>t[u](i)).join(", ")})`}function Qr(e,t){const n=It(t==="float"?2:0),s=["r","g","b"],i=Lt(e,t);return`{${se(i.getComponents("rgb")).map((b,C)=>`${s[C]}: ${n(b)}`).join(", ")}}`}function ll(e){return t=>Qr(t,e)}function Jr(e,t){const n=It(2),s=It(t==="float"?2:0),i=["r","g","b","a"];return`{${Lt(e,t).getComponents("rgb").map((C,O)=>{const T=O===3?n:s;return`${i[O]}: ${T(C)}`}).join(", ")}}`}function cl(e){return t=>Jr(t,e)}const ul=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:ps},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ds},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:Zr},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:bn},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:ol},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:al},...["int","float"].reduce((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:ll(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:cl(t)}],[])];function ti(e){return ul.reduce((t,n)=>t||(Ga(n.format,e)?n.stringifier:null),null)}const Ne=it("apl");class pl{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Ne()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);const s=t.createElement("div");s.classList.add(Ne("b")),this.element.appendChild(s);const i=t.createElement("div");i.classList.add(Ne("c")),s.appendChild(i),this.colorElem_=i;const u=t.createElement("div");u.classList.add(Ne("m")),this.element.appendChild(u),this.markerElem_=u;const b=t.createElement("div");b.classList.add(Ne("p")),this.markerElem_.appendChild(b),this.previewElem_=b,this.update_()}update_(){const t=this.value.rawValue,n=t.getComponents("rgb"),s=new ot([n[0],n[1],n[2],0],"rgb"),i=new ot([n[0],n[1],n[2],255],"rgb"),u=["to right",bn(s),bn(i)];this.colorElem_.style.background=`linear-gradient(${u.join(",")})`,this.previewElem_.style.backgroundColor=bn(t);const b=at(n[3],0,1,0,100);this.markerElem_.style.left=`${b}%`}onValueChange_(){this.update_()}}class dl{constructor(t,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new pl(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Me(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,n){if(!t.point)return;const s=t.point.x/t.bounds.width,i=this.value.rawValue,[u,b,C]=i.getComponents("hsv");this.value.setRawValue(new ot([u,b,C,s],"hsv"),n)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const n=Rt(Ce(!0),le(t));if(n===0)return;const s=this.value.rawValue,[i,u,b,C]=s.getComponents("hsv");this.value.setRawValue(new ot([i,u,b,C+n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){Rt(Ce(!0),le(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ke=it("coltxt");function hl(e){const t=e.createElement("select"),n=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return t.appendChild(n.reduce((s,i)=>{const u=e.createElement("option");return u.textContent=i.text,u.value=i.value,s.appendChild(u),s},e.createDocumentFragment())),t}class vl{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(ke()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("div");s.classList.add(ke("m")),this.modeElem_=hl(t),this.modeElem_.classList.add(ke("ms")),s.appendChild(this.modeSelectElement),n.viewProps.bindDisabled(this.modeElem_);const i=t.createElement("div");i.classList.add(ke("mm")),i.appendChild(En(t,"dropdown")),s.appendChild(i),this.element.appendChild(s);const u=t.createElement("div");u.classList.add(ke("w")),this.element.appendChild(u),this.inputsElem_=u,this.inputViews_=n.inputViews,this.applyInputViews_(),oe(n.mode,b=>{this.modeElem_.value=b})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){gr(this.inputsElem_);const t=this.element.ownerDocument;this.inputViews_.forEach(n=>{const s=t.createElement("div");s.classList.add(ke("c")),s.appendChild(n.element),this.inputsElem_.appendChild(s)})}}function fl(e){return It(e==="float"?2:0)}function ml(e,t,n){const s=Le(e,t)[n];return new We({min:0,max:s})}function bl(e,t,n){return new nn(e,{arrayPosition:n===0?"fst":n===2?"lst":"mid",parser:t.parser,props:Q.fromObject({formatter:fl(t.colorType),keyScale:Ce(!1),pointerScale:t.colorType==="float"?.01:1}),value:pt(0,{constraint:ml(t.colorMode,t.colorType,n)}),viewProps:t.viewProps})}function wl(e,t){const n={colorMode:t.colorMode,colorType:t.colorType,parser:ae,viewProps:t.viewProps};return[0,1,2].map(s=>{const i=bl(e,n,s);return Re({primary:t.value,secondary:i.value,forward(u){return Lt(u,t.colorType).getComponents(t.colorMode)[s]},backward(u,b){const C=t.colorMode,T=Lt(u,t.colorType).getComponents(C);T[s]=b;const N=us(kn(se(T),T[3]),C,t.colorType);return Lt(N,"int")}}),i})}function _l(e,t){const n=new He(e,{parser:rn("int"),props:Q.fromObject({formatter:ps}),value:pt(ot.black()),viewProps:t.viewProps});return Re({primary:t.value,secondary:n.value,forward:s=>new ot(se(s.getComponents()),s.mode),backward:(s,i)=>new ot(kn(se(i.getComponents(s.mode)),s.getComponents()[3]),s.mode)}),[n]}function gl(e){return e!=="hex"}class xl{constructor(t,n){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=n.colorType,this.value=n.value,this.viewProps=n.viewProps,this.colorMode=pt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new vl(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const n=this.colorMode.rawValue;return gl(n)?wl(t,{colorMode:n,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):_l(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){const n=t.currentTarget;this.colorMode.rawValue=n.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(s=>s.view)}}const On=it("hpl");class yl{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(On()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);const s=t.createElement("div");s.classList.add(On("c")),this.element.appendChild(s);const i=t.createElement("div");i.classList.add(On("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const t=this.value.rawValue,[n]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=Zr(new ot([n,100,100],"hsv"));const s=at(n,0,360,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class Pl{constructor(t,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new yl(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Me(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,n){if(!t.point)return;const s=at(wt(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),i=this.value.rawValue,[,u,b,C]=i.getComponents("hsv");this.value.setRawValue(new ot([s,u,b,C],"hsv"),n)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const n=Rt(Ce(!1),le(t));if(n===0)return;const s=this.value.rawValue,[i,u,b,C]=s.getComponents("hsv");this.value.setRawValue(new ot([i+n,u,b,C],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){Rt(Ce(!1),le(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Tn=it("svp"),Xs=64;class Cl{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Tn()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);const s=t.createElement("canvas");s.height=Xs,s.width=Xs,s.classList.add(Tn("c")),this.element.appendChild(s),this.canvasElement=s;const i=t.createElement("div");i.classList.add(Tn("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const t=Po(this.canvasElement);if(!t)return;const s=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,u=this.canvasElement.height,b=t.getImageData(0,0,i,u),C=b.data;for(let N=0;N<u;N++)for(let L=0;L<i;L++){const j=at(L,0,i,0,100),rt=at(N,0,u,100,0),K=Rr(s[0],j,rt),H=(N*i+L)*4;C[H]=K[0],C[H+1]=K[1],C[H+2]=K[2],C[H+3]=255}t.putImageData(b,0,0);const O=at(s[1],0,100,0,100);this.markerElem_.style.left=`${O}%`;const T=at(s[2],0,100,100,0);this.markerElem_.style.top=`${T}%`}onValueChange_(){this.update_()}}class El{constructor(t,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new Cl(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Me(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,n){if(!t.point)return;const s=at(t.point.x,0,t.bounds.width,0,100),i=at(t.point.y,0,t.bounds.height,100,0),[u,,,b]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ot([u,s,i,b],"hsv"),n)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Lr(t.key)&&t.preventDefault();const[n,s,i,u]=this.value.rawValue.getComponents("hsv"),b=Ce(!1),C=Rt(b,le(t)),O=Rt(b,Ye(t));C===0&&O===0||this.value.setRawValue(new ot([n,s+C,i+O,u],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const n=Ce(!1),s=Rt(n,le(t)),i=Rt(n,Ye(t));s===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ml{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.hPaletteC_=new Pl(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new El(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=n.supportsAlpha?{palette:new dl(t,{value:this.value,viewProps:this.viewProps}),text:new nn(t,{parser:ae,props:Q.fromObject({pointerScale:.01,keyScale:.1,formatter:It(2)}),value:pt(0,{constraint:new We({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Re({primary:this.value,secondary:this.alphaIcs_.text.value,forward:s=>s.getComponents()[3],backward:(s,i)=>{const u=s.getComponents();return u[3]=i,new ot(u,s.mode)}}),this.textsC_=new xl(t,{colorType:n.colorType,value:this.value,viewProps:this.viewProps}),this.view=new ja(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:n.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const zn=it("colsw");class kl{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.element=t.createElement("div"),this.element.classList.add(zn()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("div");s.classList.add(zn("sw")),this.element.appendChild(s),this.swatchElem_=s;const i=t.createElement("button");i.classList.add(zn("b")),n.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=ds(t)}onValueChange_(){this.update_()}}class Sl{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new kl(t,{value:this.value,viewProps:this.viewProps})}}class hs{constructor(t,n){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=Qe.create(n.expanded),this.swatchC_=new Sl(t,{value:this.value,viewProps:this.viewProps});const s=this.swatchC_.view.buttonElement;s.addEventListener("blur",this.onButtonBlur_),s.addEventListener("click",this.onButtonClick_),this.textC_=new He(t,{parser:n.parser,props:Q.fromObject({formatter:n.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Aa(t,{foldable:this.foldable_,pickerLayout:n.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=n.pickerLayout==="popup"?new Dr(t,{viewProps:this.viewProps}):null;const i=new Ml(t,{colorType:n.colorType,supportsAlpha:n.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(u=>{u.addEventListener("blur",this.onPopupChildBlur_),u.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),Re({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:u=>u,backward:(u,b)=>b})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),rs(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const n=this.view.element,s=t.relatedTarget;(!s||!n.contains(s))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const n=this.popC_.view.element,s=xr(t);s&&n.contains(s)||s&&s===this.swatchC_.view.buttonElement&&!Qn(n.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Vl(e){return se(e.getComponents("rgb")).reduce((t,n)=>t<<8|Math.floor(n)&255,0)}function Dl(e){return e.getComponents("rgb").reduce((t,n,s)=>{const i=Math.floor(s===3?n*255:n)&255;return t<<8|i},0)>>>0}function Al(e){return new ot([e>>16&255,e>>8&255,e&255],"rgb")}function Bl(e){return new ot([e>>24&255,e>>16&255,e>>8&255,at(e&255,0,255,0,1)],"rgb")}function Ll(e){return typeof e!="number"?ot.black():Al(e)}function Ol(e){return typeof e!="number"?ot.black():Bl(e)}function wn(e,t){return typeof e!="object"||ut(e)?!1:t in e&&typeof e[t]=="number"}function ei(e){return wn(e,"r")&&wn(e,"g")&&wn(e,"b")}function ni(e){return ei(e)&&wn(e,"a")}function si(e){return ei(e)}function vs(e,t){if(e.mode!==t.mode||e.type!==t.type)return!1;const n=e.getComponents(),s=t.getComponents();for(let i=0;i<n.length;i++)if(n[i]!==s[i])return!1;return!0}function Ws(e){return"a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b]}function Tl(e){const t=ti(e);return t?(n,s)=>{sn(n,t(s))}:null}function zl(e){const t=e?Dl:Vl;return(n,s)=>{sn(n,t(s))}}function Rl(e,t,n){const i=Lt(t,n).toRgbaObject();e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b),e.writeProperty("a",i.a)}function Il(e,t,n){const i=Lt(t,n).toRgbaObject();e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b)}function jl(e,t){return(n,s)=>{e?Rl(n,s,t):Il(n,s,t)}}function ql(e){var t;return!!(!((t=e==null?void 0:e.color)===null||t===void 0)&&t.alpha)}function Nl(e){return e?t=>ds(t,"0x"):t=>ps(t,"0x")}function Fl(e){return"color"in e||e.view==="color"}const Ul=Ot({id:"input-color-number",type:"input",accept:(e,t)=>{if(typeof e!="number"||!Fl(t))return null;const n=ls(t);return n?{initialValue:e,params:Object.assign(Object.assign({},n),{supportsAlpha:ql(t)})}:null},binding:{reader:e=>e.params.supportsAlpha?Ol:Ll,equals:vs,writer:e=>zl(e.params.supportsAlpha)},controller:e=>{var t,n;return new hs(e.document,{colorType:"int",expanded:(t=e.params.expanded)!==null&&t!==void 0?t:!1,formatter:Nl(e.params.supportsAlpha),parser:rn("int"),pickerLayout:(n=e.params.picker)!==null&&n!==void 0?n:"popup",supportsAlpha:e.params.supportsAlpha,value:e.value,viewProps:e.viewProps})}});function $l(e,t){if(!si(e))return Lt(ot.black(),t);if(t==="int"){const n=Ws(e);return new ot(n,"rgb")}if(t==="float"){const n=Ws(e);return new cs(n,"rgb")}return Lt(ot.black(),"int")}function Kl(e){return ni(e)}function Gl(e){return t=>{const n=$l(t,e);return Lt(n,"int")}}function Hl(e,t){return n=>e?Jr(n,t):Qr(n,t)}const Yl=Ot({id:"input-color-object",type:"input",accept:(e,t)=>{var n;if(!si(e))return null;const s=ls(t);return s?{initialValue:e,params:Object.assign(Object.assign({},s),{colorType:(n=qr(t))!==null&&n!==void 0?n:"int"})}:null},binding:{reader:e=>Gl(e.params.colorType),equals:vs,writer:e=>jl(Kl(e.initialValue),e.params.colorType)},controller:e=>{var t,n;const s=ni(e.initialValue);return new hs(e.document,{colorType:e.params.colorType,expanded:(t=e.params.expanded)!==null&&t!==void 0?t:!1,formatter:Hl(s,e.params.colorType),parser:rn("int"),pickerLayout:(n=e.params.picker)!==null&&n!==void 0?n:"popup",supportsAlpha:s,value:e.value,viewProps:e.viewProps})}}),Xl=Ot({id:"input-color-string",type:"input",accept:(e,t)=>{if(typeof e!="string"||t.view==="text")return null;const n=rl(e,qr(t));if(!n)return null;const s=ti(n);if(!s)return null;const i=ls(t);return i?{initialValue:e,params:Object.assign(Object.assign({},i),{format:n,stringifier:s})}:null},binding:{reader:()=>il,equals:vs,writer:e=>{const t=Tl(e.params.format);if(!t)throw vt.notBindable();return t}},controller:e=>{var t,n;return new hs(e.document,{colorType:e.params.format.type,expanded:(t=e.params.expanded)!==null&&t!==void 0?t:!1,formatter:e.params.stringifier,parser:rn("int"),pickerLayout:(n=e.params.picker)!==null&&n!==void 0?n:"popup",supportsAlpha:e.params.format.alpha,value:e.value,viewProps:e.viewProps})}});class fs{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const n=this.asm_.toComponents(t).map((s,i)=>{var u,b;return(b=(u=this.components[i])===null||u===void 0?void 0:u.constrain(s))!==null&&b!==void 0?b:s});return this.asm_.fromComponents(n)}}const Zs=it("pndtxt");class Wl{constructor(t,n){this.textViews=n.textViews,this.element=t.createElement("div"),this.element.classList.add(Zs()),this.textViews.forEach(s=>{const i=t.createElement("div");i.classList.add(Zs("a")),i.appendChild(s.element),this.element.appendChild(i)})}}function Zl(e,t,n){return new nn(e,{arrayPosition:n===0?"fst":n===t.axes.length-1?"lst":"mid",parser:t.parser,props:t.axes[n].textProps,value:pt(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}class ms{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.acs_=n.axes.map((s,i)=>Zl(t,n,i)),this.acs_.forEach((s,i)=>{Re({primary:this.value,secondary:s.value,forward:u=>n.assembly.toComponents(u)[i],backward:(u,b)=>{const C=n.assembly.toComponents(u);return C[i]=b,n.assembly.fromComponents(C)}})}),this.view=new Wl(t,{textViews:this.acs_.map(s=>s.view)})}get textControllers(){return this.acs_}}class Ql extends Ge{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}function Jl(e,t){const n=[],s=vr(e,t);s&&n.push(s);const i=fr(e);i&&n.push(i);const u=as(e.options);return u&&n.push(u),new Je(n)}const tc=Ot({id:"input-number",type:"input",accept:(e,t)=>{if(typeof e!="number")return null;const n=ht(t,s=>Object.assign(Object.assign({},br(s)),{options:s.optional.custom(en),readonly:s.optional.constant(!1)}));return n?{initialValue:e,params:n}:null},binding:{reader:e=>ur,constraint:e=>Jl(e.params,e.initialValue),writer:e=>sn},controller:e=>{const t=e.value,n=e.constraint,s=n&&xn(n,tn);if(s)return new be(e.document,{props:new Q({options:s.values.value("options")}),value:t,viewProps:e.viewProps});const i=mr(e.params,t.rawValue),u=n&&xn(n,We);return u?new Pn(e.document,Object.assign(Object.assign({},Or(Object.assign(Object.assign({},i),{keyScale:pt(i.keyScale),max:u.values.value("max"),min:u.values.value("min")}))),{parser:ae,value:t,viewProps:e.viewProps})):new nn(e.document,{parser:ae,props:Q.fromObject(i),value:t,viewProps:e.viewProps})},api(e){return typeof e.controller.value.rawValue!="number"?null:e.controller.valueController instanceof Pn?new Ql(e.controller):e.controller.valueController instanceof be?new is(e.controller):null}});class me{constructor(t=0,n=0){this.x=t,this.y=n}getComponents(){return[this.x,this.y]}static isObject(t){if(ut(t))return!1;const n=t.x,s=t.y;return!(typeof n!="number"||typeof s!="number")}static equals(t,n){return t.x===n.x&&t.y===n.y}toObject(){return{x:this.x,y:this.y}}}const ri={toComponents:e=>e.getComponents(),fromComponents:e=>new me(...e)},Se=it("p2d");class ec{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Se()),n.viewProps.bindClassModifiers(this.element),oe(n.expanded,Oe(this.element,Se(void 0,"expanded")));const s=t.createElement("div");s.classList.add(Se("h")),this.element.appendChild(s);const i=t.createElement("button");i.classList.add(Se("b")),i.appendChild(En(t,"p2dpad")),n.viewProps.bindDisabled(i),s.appendChild(i),this.buttonElement=i;const u=t.createElement("div");if(u.classList.add(Se("t")),s.appendChild(u),this.textElement=u,n.pickerLayout==="inline"){const b=t.createElement("div");b.classList.add(Se("p")),this.element.appendChild(b),this.pickerElement=b}else this.pickerElement=null}}const pe=it("p2dp");class nc{constructor(t,n){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(pe()),n.layout==="popup"&&this.element.classList.add(pe(void 0,"p")),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("div");s.classList.add(pe("p")),n.viewProps.bindTabIndex(s),this.element.appendChild(s),this.padElement=s;const i=t.createElementNS(ee,"svg");i.classList.add(pe("g")),this.padElement.appendChild(i),this.svgElem_=i;const u=t.createElementNS(ee,"line");u.classList.add(pe("ax")),u.setAttributeNS(null,"x1","0"),u.setAttributeNS(null,"y1","50%"),u.setAttributeNS(null,"x2","100%"),u.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(u);const b=t.createElementNS(ee,"line");b.classList.add(pe("ax")),b.setAttributeNS(null,"x1","50%"),b.setAttributeNS(null,"y1","0"),b.setAttributeNS(null,"x2","50%"),b.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(b);const C=t.createElementNS(ee,"line");C.classList.add(pe("l")),C.setAttributeNS(null,"x1","50%"),C.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(C),this.lineElem_=C;const O=t.createElement("div");O.classList.add(pe("m")),this.padElement.appendChild(O),this.markerElem_=O,n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,n]=this.value.rawValue.getComponents(),s=this.props_.get("max"),i=at(t,-s,+s,0,100),u=at(n,-s,+s,0,100),b=this.props_.get("invertsY")?100-u:u;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${b}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${b}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Qs(e,t,n){return[Rt(t[0],le(e)),Rt(t[1],Ye(e))*(n?1:-1)]}class sc{constructor(t,n){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new nc(t,{layout:n.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Me(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,n){if(!t.point)return;const s=this.props.get("max"),i=at(t.point.x,0,t.bounds.width,-s,+s),u=at(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-s,+s);this.value.setRawValue(new me(i,u),n)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Lr(t.key)&&t.preventDefault();const[n,s]=Qs(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));n===0&&s===0||this.value.setRawValue(new me(this.value.rawValue.x+n,this.value.rawValue.y+s),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[n,s]=Qs(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));n===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class rc{constructor(t,n){var s,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=Qe.create(n.expanded),this.popC_=n.pickerLayout==="popup"?new Dr(t,{viewProps:this.viewProps}):null;const u=new sc(t,{layout:n.pickerLayout,props:new Q({invertsY:pt(n.invertsY),max:pt(n.max),xKeyScale:n.axes[0].textProps.value("keyScale"),yKeyScale:n.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});u.view.allFocusableElements.forEach(b=>{b.addEventListener("blur",this.onPopupChildBlur_),b.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=u,this.textC_=new ms(t,{assembly:ri,axes:n.axes,parser:n.parser,value:this.value,viewProps:this.viewProps}),this.view=new ec(t,{expanded:this.foldable_.value("expanded"),pickerLayout:n.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("blur",this.onPadButtonBlur_),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Re({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:b=>b,backward:(b,C)=>C})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),rs(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;const n=this.view.element,s=t.relatedTarget;(!s||!n.contains(s))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const n=this.popC_.view.element,s=xr(t);s&&n.contains(s)||s&&s===this.view.buttonElement&&!Qn(n.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}}function ic(e){return me.isObject(e)?new me(e.x,e.y):new me}function oc(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function ac(e,t){return new fs({assembly:ri,components:[ie(Object.assign(Object.assign({},e),e.x),t.x),ie(Object.assign(Object.assign({},e),e.y),t.y)]})}function Js(e,t){var n,s;if(!ut(e.min)||!ut(e.max))return Math.max(Math.abs((n=e.min)!==null&&n!==void 0?n:0),Math.abs((s=e.max)!==null&&s!==void 0?s:0));const i=dr(e);return Math.max(Math.abs(i)*10,Math.abs(t)*10)}function lc(e,t){var n,s;const i=Js(ye(e,(n=e.x)!==null&&n!==void 0?n:{}),t.x),u=Js(ye(e,(s=e.y)!==null&&s!==void 0?s:{}),t.y);return Math.max(i,u)}function cc(e){if(!("y"in e))return!1;const t=e.y;return t&&"inverted"in t?!!t.inverted:!1}const uc=Ot({id:"input-point2d",type:"input",accept:(e,t)=>{if(!me.isObject(e))return null;const n=ht(t,s=>Object.assign(Object.assign({},Xe(s)),{expanded:s.optional.boolean,picker:s.optional.custom(zr),readonly:s.optional.constant(!1),x:s.optional.custom(fe),y:s.optional.object(Object.assign(Object.assign({},Xe(s)),{inverted:s.optional.boolean}))}));return n?{initialValue:e,params:n}:null},binding:{reader:()=>ic,constraint:e=>ac(e.params,e.initialValue),equals:me.equals,writer:()=>oc},controller:e=>{var t,n;const s=e.document,i=e.value,u=e.constraint,b=[e.params.x,e.params.y];return new rc(s,{axes:i.rawValue.getComponents().map((C,O)=>{var T;return Zn({constraint:u.components[O],initialValue:C,params:ye(e.params,(T=b[O])!==null&&T!==void 0?T:{})})}),expanded:(t=e.params.expanded)!==null&&t!==void 0?t:!1,invertsY:cc(e.params),max:lc(e.params,i.rawValue),parser:ae,pickerLayout:(n=e.params.picker)!==null&&n!==void 0?n:"popup",value:i,viewProps:e.viewProps})}});class Ve{constructor(t=0,n=0,s=0){this.x=t,this.y=n,this.z=s}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(ut(t))return!1;const n=t.x,s=t.y,i=t.z;return!(typeof n!="number"||typeof s!="number"||typeof i!="number")}static equals(t,n){return t.x===n.x&&t.y===n.y&&t.z===n.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const ii={toComponents:e=>e.getComponents(),fromComponents:e=>new Ve(...e)};function pc(e){return Ve.isObject(e)?new Ve(e.x,e.y,e.z):new Ve}function dc(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}function hc(e,t){return new fs({assembly:ii,components:[ie(Object.assign(Object.assign({},e),e.x),t.x),ie(Object.assign(Object.assign({},e),e.y),t.y),ie(Object.assign(Object.assign({},e),e.z),t.z)]})}const vc=Ot({id:"input-point3d",type:"input",accept:(e,t)=>{if(!Ve.isObject(e))return null;const n=ht(t,s=>Object.assign(Object.assign({},Xe(s)),{readonly:s.optional.constant(!1),x:s.optional.custom(fe),y:s.optional.custom(fe),z:s.optional.custom(fe)}));return n?{initialValue:e,params:n}:null},binding:{reader:e=>pc,constraint:e=>hc(e.params,e.initialValue),equals:Ve.equals,writer:e=>dc},controller:e=>{const t=e.value,n=e.constraint,s=[e.params.x,e.params.y,e.params.z];return new ms(e.document,{assembly:ii,axes:t.rawValue.getComponents().map((i,u)=>{var b;return Zn({constraint:n.components[u],initialValue:i,params:ye(e.params,(b=s[u])!==null&&b!==void 0?b:{})})}),parser:ae,value:t,viewProps:e.viewProps})}});class De{constructor(t=0,n=0,s=0,i=0){this.x=t,this.y=n,this.z=s,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(ut(t))return!1;const n=t.x,s=t.y,i=t.z,u=t.w;return!(typeof n!="number"||typeof s!="number"||typeof i!="number"||typeof u!="number")}static equals(t,n){return t.x===n.x&&t.y===n.y&&t.z===n.z&&t.w===n.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const oi={toComponents:e=>e.getComponents(),fromComponents:e=>new De(...e)};function fc(e){return De.isObject(e)?new De(e.x,e.y,e.z,e.w):new De}function mc(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}function bc(e,t){return new fs({assembly:oi,components:[ie(Object.assign(Object.assign({},e),e.x),t.x),ie(Object.assign(Object.assign({},e),e.y),t.y),ie(Object.assign(Object.assign({},e),e.z),t.z),ie(Object.assign(Object.assign({},e),e.w),t.w)]})}const wc=Ot({id:"input-point4d",type:"input",accept:(e,t)=>{if(!De.isObject(e))return null;const n=ht(t,s=>Object.assign(Object.assign({},Xe(s)),{readonly:s.optional.constant(!1),w:s.optional.custom(fe),x:s.optional.custom(fe),y:s.optional.custom(fe),z:s.optional.custom(fe)}));return n?{initialValue:e,params:n}:null},binding:{reader:e=>fc,constraint:e=>bc(e.params,e.initialValue),equals:De.equals,writer:e=>mc},controller:e=>{const t=e.value,n=e.constraint,s=[e.params.x,e.params.y,e.params.z,e.params.w];return new ms(e.document,{assembly:oi,axes:t.rawValue.getComponents().map((i,u)=>{var b;return Zn({constraint:n.components[u],initialValue:i,params:ye(e.params,(b=s[u])!==null&&b!==void 0?b:{})})}),parser:ae,value:t,viewProps:e.viewProps})}});function _c(e){const t=[],n=as(e.options);return n&&t.push(n),new Je(t)}const gc=Ot({id:"input-string",type:"input",accept:(e,t)=>{if(typeof e!="string")return null;const n=ht(t,s=>({readonly:s.optional.constant(!1),options:s.optional.custom(en)}));return n?{initialValue:e,params:n}:null},binding:{reader:e=>Br,constraint:e=>_c(e.params),writer:e=>sn},controller:e=>{const t=e.document,n=e.value,s=e.constraint,i=s&&xn(s,tn);return i?new be(t,{props:new Q({options:i.values.value("options")}),value:n,viewProps:e.viewProps}):new He(t,{parser:u=>u,props:Q.fromObject({formatter:Fn}),value:n,viewProps:e.viewProps})},api(e){return typeof e.controller.value.rawValue!="string"?null:e.controller.valueController instanceof be?new is(e.controller):null}}),on={monitor:{defaultInterval:200,defaultRows:3}},tr=it("mll");class xc{constructor(t,n){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=t.createElement("div"),this.element.classList.add(tr()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("textarea");s.classList.add(tr("i")),s.style.height=`calc(var(${Tr("containerUnitSize")}) * ${n.rows})`,s.readOnly=!0,n.viewProps.bindDisabled(s),this.element.appendChild(s),this.textareaElem_=s,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}update_(){const t=this.textareaElem_,n=t.scrollTop===t.scrollHeight-t.clientHeight,s=[];this.value.rawValue.forEach(i=>{i!==void 0&&s.push(this.formatter_(i))}),t.textContent=s.join(`
`),n&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class bs{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new xc(t,{formatter:n.formatter,rows:n.rows,value:this.value,viewProps:this.viewProps})}}const er=it("sgl");class yc{constructor(t,n){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=t.createElement("div"),this.element.classList.add(er()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("input");s.classList.add(er("i")),s.readOnly=!0,s.type="text",n.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}update_(){const t=this.value.rawValue,n=t[t.length-1];this.inputElement.value=n!==void 0?this.formatter_(n):""}onValueUpdate_(){this.update_()}}class ws{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new yc(t,{formatter:n.formatter,value:this.value,viewProps:this.viewProps})}}const Pc=Ot({id:"monitor-bool",type:"monitor",accept:(e,t)=>{if(typeof e!="boolean")return null;const n=ht(t,s=>({readonly:s.required.constant(!0),rows:s.optional.number}));return n?{initialValue:e,params:n}:null},binding:{reader:e=>Ar},controller:e=>{var t;return e.value.rawValue.length===1?new ws(e.document,{formatter:Hs,value:e.value,viewProps:e.viewProps}):new bs(e.document,{formatter:Hs,rows:(t=e.params.rows)!==null&&t!==void 0?t:on.monitor.defaultRows,value:e.value,viewProps:e.viewProps})}});class Cc extends Ge{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}const de=it("grl");class Ec{constructor(t,n){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(de()),n.viewProps.bindClassModifiers(this.element),this.formatter_=n.formatter,this.props_=n.props,this.cursor_=n.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const s=t.createElementNS(ee,"svg");s.classList.add(de("g")),s.style.height=`calc(var(${Tr("containerUnitSize")}) * ${n.rows})`,this.element.appendChild(s),this.svgElem_=s;const i=t.createElementNS(ee,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const u=t.createElement("div");u.classList.add(de("t"),it("tt")()),this.element.appendChild(u),this.tooltipElem_=u,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:t,clientHeight:n}=this.element,s=this.value.rawValue.length-1,i=this.props_.get("min"),u=this.props_.get("max"),b=[];this.value.rawValue.forEach((L,j)=>{if(L===void 0)return;const rt=at(j,0,s,0,t),K=at(L,i,u,n,0);b.push([rt,K].join(","))}),this.lineElem_.setAttributeNS(null,"points",b.join(" "));const C=this.tooltipElem_,O=this.value.rawValue[this.cursor_.rawValue];if(O===void 0){C.classList.remove(de("t","a"));return}const T=at(this.cursor_.rawValue,0,s,0,t),N=at(O,i,u,n,0);C.style.left=`${T}px`,C.style.top=`${N}px`,C.textContent=`${this.formatter_(O)}`,C.classList.contains(de("t","a"))||(C.classList.add(de("t","a"),de("t","in")),gn(C),C.classList.remove(de("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ai{constructor(t,n){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.cursor_=pt(-1),this.view=new Ec(t,{cursor:this.cursor_,formatter:n.formatter,rows:n.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Qn(t))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const s=new Me(this.view.element);s.emitter.on("down",this.onGraphPointerDown_),s.emitter.on("move",this.onGraphPointerMove_),s.emitter.on("up",this.onGraphPointerUp_)}}importProps(t){return Gt(t,null,n=>({max:n.required.number,min:n.required.number}),n=>(this.props.set("max",n.max),this.props.set("min",n.min),!0))}exportProps(){return Ht(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const{clientWidth:n}=this.view.element;this.cursor_.rawValue=Math.floor(at(t.offsetX,0,n,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(at(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Un(e){return ut(e.format)?It(2):e.format}function Mc(e){var t;return e.value.rawValue.length===1?new ws(e.document,{formatter:Un(e.params),value:e.value,viewProps:e.viewProps}):new bs(e.document,{formatter:Un(e.params),rows:(t=e.params.rows)!==null&&t!==void 0?t:on.monitor.defaultRows,value:e.value,viewProps:e.viewProps})}function kc(e){var t,n,s;return new ai(e.document,{formatter:Un(e.params),rows:(t=e.params.rows)!==null&&t!==void 0?t:on.monitor.defaultRows,props:Q.fromObject({max:(n=e.params.max)!==null&&n!==void 0?n:100,min:(s=e.params.min)!==null&&s!==void 0?s:0}),value:e.value,viewProps:e.viewProps})}function nr(e){return e.view==="graph"}const Sc=Ot({id:"monitor-number",type:"monitor",accept:(e,t)=>{if(typeof e!="number")return null;const n=ht(t,s=>({format:s.optional.function,max:s.optional.number,min:s.optional.number,readonly:s.required.constant(!0),rows:s.optional.number,view:s.optional.string}));return n?{initialValue:e,params:n}:null},binding:{defaultBufferSize:e=>nr(e)?64:1,reader:e=>ur},controller:e=>nr(e.params)?kc(e):Mc(e),api:e=>e.controller.valueController instanceof ai?new Cc(e.controller):null}),Vc=Ot({id:"monitor-string",type:"monitor",accept:(e,t)=>{if(typeof e!="string")return null;const n=ht(t,s=>({multiline:s.optional.boolean,readonly:s.required.constant(!0),rows:s.optional.number}));return n?{initialValue:e,params:n}:null},binding:{reader:e=>Br},controller:e=>{var t;const n=e.value;return n.rawValue.length>1||e.params.multiline?new bs(e.document,{formatter:Fn,rows:(t=e.params.rows)!==null&&t!==void 0?t:on.monitor.defaultRows,value:n,viewProps:e.viewProps}):new ws(e.document,{formatter:Fn,value:n,viewProps:e.viewProps})}});class Dc{constructor(){this.map_=new Map}get(t){var n;return(n=this.map_.get(t))!==null&&n!==void 0?n:null}has(t){return this.map_.has(t)}add(t,n){return this.map_.set(t,n),t.viewProps.handleDispose(()=>{this.map_.delete(t)}),n}}class Ac{constructor(t){this.target=t.target,this.reader_=t.reader,this.writer_=t.writer}read(){return this.reader_(this.target.read())}write(t){this.writer_(this.target,t)}inject(t){this.write(this.reader_(t))}}function Bc(e,t){var n;const s=e.accept(t.target.read(),t.params);if(ut(s))return null;const i={target:t.target,initialValue:s.initialValue,params:s.params},u=ht(t.params,L=>({disabled:L.optional.boolean,hidden:L.optional.boolean,label:L.optional.string,tag:L.optional.string})),b=e.binding.reader(i),C=e.binding.constraint?e.binding.constraint(i):void 0,O=new Ac({reader:b,target:t.target,writer:e.binding.writer(i)}),T=new fo(pt(b(s.initialValue),{constraint:C,equals:e.binding.equals}),O),N=e.controller({constraint:C,document:t.document,initialValue:s.initialValue,params:s.params,value:T,viewProps:ce.create({disabled:u==null?void 0:u.disabled,hidden:u==null?void 0:u.hidden})});return new Do(t.document,{blade:ze(),props:Q.fromObject({label:"label"in t.params?(n=u==null?void 0:u.label)!==null&&n!==void 0?n:null:t.target.key}),tag:u==null?void 0:u.tag,value:T,valueController:N})}class Lc{constructor(t){this.target=t.target,this.reader_=t.reader}read(){return this.reader_(this.target.read())}}function Oc(e,t){return t===0?new da:new ha(e,t??on.monitor.defaultInterval)}function Tc(e,t){var n,s,i;const u=e.accept(t.target.read(),t.params);if(ut(u))return null;const b={target:t.target,initialValue:u.initialValue,params:u.params},C=ht(t.params,j=>({bufferSize:j.optional.number,disabled:j.optional.boolean,hidden:j.optional.boolean,interval:j.optional.number,label:j.optional.string})),O=e.binding.reader(b),T=(s=(n=C==null?void 0:C.bufferSize)!==null&&n!==void 0?n:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(u.params))!==null&&s!==void 0?s:1,N=new To({binding:new Lc({reader:O,target:t.target}),bufferSize:T,ticker:Oc(t.document,C==null?void 0:C.interval)}),L=e.controller({document:t.document,params:u.params,value:N,viewProps:ce.create({disabled:C==null?void 0:C.disabled,hidden:C==null?void 0:C.hidden})});return L.viewProps.bindDisabled(N.ticker),L.viewProps.handleDispose(()=>{N.ticker.dispose()}),new Ro(t.document,{blade:ze(),props:Q.fromObject({label:"label"in t.params?(i=C==null?void 0:C.label)!==null&&i!==void 0?i:null:t.target.key}),value:N,valueController:L})}class zc{constructor(t){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=t}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t,n){if(!Ma(n.core))throw vt.notCompatible(t,n.id);n.type==="blade"?this.pluginsMap_.blades.unshift(n):n.type==="input"?this.pluginsMap_.inputs.unshift(n):n.type==="monitor"&&this.pluginsMap_.monitors.unshift(n)}createInput_(t,n,s){return this.pluginsMap_.inputs.reduce((i,u)=>i??Bc(u,{document:t,target:n,params:s}),null)}createMonitor_(t,n,s){return this.pluginsMap_.monitors.reduce((i,u)=>i??Tc(u,{document:t,params:s,target:n}),null)}createBinding(t,n,s){const i=n.read();if(ut(i))throw new vt({context:{key:n.key},type:"nomatchingcontroller"});const u=this.createInput_(t,n,s);if(u)return u;const b=this.createMonitor_(t,n,s);if(b)return b;throw new vt({context:{key:n.key},type:"nomatchingcontroller"})}createBlade(t,n){const s=this.pluginsMap_.blades.reduce((i,u)=>i??pa(u,{document:t,params:n}),null);if(!s)throw new vt({type:"nomatchingview",context:{params:n}});return s}createInputBindingApi_(t){const n=this.pluginsMap_.inputs.reduce((s,i)=>{var u,b;return s||((b=(u=i.api)===null||u===void 0?void 0:u.call(i,{controller:t}))!==null&&b!==void 0?b:null)},null);return this.apiCache_.add(t,n??new Ge(t))}createMonitorBindingApi_(t){const n=this.pluginsMap_.monitors.reduce((s,i)=>{var u,b;return s||((b=(u=i.api)===null||u===void 0?void 0:u.call(i,{controller:t}))!==null&&b!==void 0?b:null)},null);return this.apiCache_.add(t,n??new Ge(t))}createBindingApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(Ao(t))return this.createInputBindingApi_(t);if(Io(t))return this.createMonitorBindingApi_(t);throw vt.shouldNeverHappen()}createApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(Vo(t))return this.createBindingApi(t);const n=this.pluginsMap_.blades.reduce((s,i)=>s??i.api({controller:t,pool:this}),null);if(!n)throw vt.shouldNeverHappen();return this.apiCache_.add(t,n)}}const Rc=new Dc;function Ic(){const e=new zc(Rc);return[uc,vc,wc,gc,tc,Xl,Yl,Ul,Da,Pc,Vc,Sc,Uo,na,Vr].forEach(t=>{e.register("core",t)}),e}class jc extends Ee{constructor(t){super(t),this.emitter_=new ft,this.controller.value.emitter.on("change",n=>{this.emitter_.emit("change",new Ze(this,n.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,n){const s=n.bind(this);return this.emitter_.on(t,i=>{s(i)},{key:n}),this}off(t,n){return this.emitter_.off(t,n),this}}class qc extends Ee{}class Nc extends Ee{constructor(t){super(t),this.emitter_=new ft,this.controller.value.emitter.on("change",n=>{this.emitter_.emit("change",new Ze(this,n.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,n){const s=n.bind(this);return this.emitter_.on(t,i=>{s(i)},{key:n}),this}off(t,n){return this.emitter_.off(t,n),this}}class Fc extends Ee{constructor(t){super(t),this.emitter_=new ft,this.controller.value.emitter.on("change",n=>{this.emitter_.emit("change",new Ze(this,n.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(t){this.controller.valueController.props.set("formatter",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,n){const s=n.bind(this);return this.emitter_.on(t,i=>{s(i)},{key:n}),this}off(t,n){return this.emitter_.off(t,n),this}}const Uc=function(){return{id:"list",type:"blade",core:Te,accept(e){const t=ht(e,n=>({options:n.required.custom(en),value:n.required.raw,view:n.required.constant("list"),label:n.optional.string}));return t?{params:t}:null},controller(e){const t=new tn(os(e.params.options)),n=pt(e.params.value,{constraint:t}),s=new be(e.document,{props:new Q({options:t.values.value("options")}),value:n,viewProps:e.viewProps});return new Pe(e.document,{blade:e.blade,props:Q.fromObject({label:e.params.label}),value:n,valueController:s})},api(e){return!(e.controller instanceof Pe)||!(e.controller.valueController instanceof be)?null:new jc(e.controller)}}}();class $c extends kr{constructor(t,n){super(t,n)}get element(){return this.controller.view.element}}class Kc extends qn{constructor(t,n){super(t,{expanded:n.expanded,blade:n.blade,props:n.props,root:!0,viewProps:n.viewProps})}}const sr=it("spr");class Gc{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(sr()),n.viewProps.bindClassModifiers(this.element);const s=t.createElement("hr");s.classList.add(sr("r")),this.element.appendChild(s)}}class rr extends Mn{constructor(t,n){super(Object.assign(Object.assign({},n),{view:new Gc(t,{viewProps:n.viewProps})}))}}const Hc={id:"separator",type:"blade",core:Te,accept(e){const t=ht(e,n=>({view:n.required.constant("separator")}));return t?{params:t}:null},controller(e){return new rr(e.document,{blade:e.blade,viewProps:e.viewProps})},api(e){return e.controller instanceof rr?new qc(e.controller):null}},Yc={id:"slider",type:"blade",core:Te,accept(e){const t=ht(e,n=>({max:n.required.number,min:n.required.number,view:n.required.constant("slider"),format:n.optional.function,label:n.optional.string,value:n.optional.number}));return t?{params:t}:null},controller(e){var t,n;const s=(t=e.params.value)!==null&&t!==void 0?t:0,i=new We({max:e.params.max,min:e.params.min}),u=pt(s,{constraint:i}),b=new Pn(e.document,Object.assign(Object.assign({},Or({formatter:(n=e.params.format)!==null&&n!==void 0?n:co,keyScale:pt(1),max:i.values.value("max"),min:i.values.value("min"),pointerScale:hr(e.params,s)})),{parser:ae,value:u,viewProps:e.viewProps}));return new Pe(e.document,{blade:e.blade,props:Q.fromObject({label:e.params.label}),value:u,valueController:b})},api(e){return!(e.controller instanceof Pe)||!(e.controller.valueController instanceof Pn)?null:new Nc(e.controller)}},Xc=function(){return{id:"text",type:"blade",core:Te,accept(e){const t=ht(e,n=>({parse:n.required.function,value:n.required.raw,view:n.required.constant("text"),format:n.optional.function,label:n.optional.string}));return t?{params:t}:null},controller(e){var t;const n=pt(e.params.value),s=new He(e.document,{parser:e.params.parse,props:Q.fromObject({formatter:(t=e.params.format)!==null&&t!==void 0?t:i=>String(i)}),value:n,viewProps:e.viewProps});return new Pe(e.document,{blade:e.blade,props:Q.fromObject({label:e.params.label}),value:n,valueController:s})},api(e){return!(e.controller instanceof Pe)||!(e.controller.valueController instanceof He)?null:new Fc(e.controller)}}}();function Wc(e){const t=e.createElement("div");return t.classList.add(it("dfw")()),e.body&&e.body.appendChild(t),t}function Zc(e,t,n){if(e.querySelector(`style[data-tp-style=${t}]`))return;const s=e.createElement("style");s.dataset.tpStyle=t,s.textContent=n,e.head.appendChild(s)}class Qc extends $c{constructor(t){var n,s;const i=t??{},u=(n=i.document)!==null&&n!==void 0?n:yo(),b=Ic(),C=new Kc(u,{expanded:i.expanded,blade:ze(),props:Q.fromObject({title:i.title}),viewProps:ce.create()});super(C,b),this.pool_=b,this.containerElem_=(s=i.container)!==null&&s!==void 0?s:Wc(u),this.containerElem_.appendChild(this.element),this.doc_=u,this.usesDefaultWrapper_=!i.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw vt.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw vt.alreadyDisposed();if(this.usesDefaultWrapper_){const n=t.parentElement;n&&n.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){t.css&&Zc(this.document,`plugin-${t.id}`,t.css),("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(s=>{this.pool_.register(t.id,s)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[Uc,Hc,Yc,Vr,Xc]})}}new Mr("4.0.4");const Wt=256,_e=64,$n=64,Ae=24,Fe=80,li=4,Be=25e4,mn=128*1024*1024,_s=[[1,0,0,1],[0,1,0,1],[0,0,1,1],[1,1,1,1]];class Jc{constructor(t,n,s,i,u){this.x=t,this.y=n,this.speed=s,this.scale=i,this.meshIndex=u}getModelTransform(t){t[0]=this.scale,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=this.scale,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=this.x,t[13]=this.y,t[14]=0,t[15]=1}writeVertices(t,n){const s=_s[this.meshIndex],i=[this.x-this.scale,this.y+this.scale,s[0],s[1],s[2],s[3],this.x-this.scale,this.y-this.scale,s[0],s[1],s[2],s[3],this.x+this.scale,this.y+this.scale,s[0],s[1],s[2],s[3],this.x+this.scale,this.y+this.scale,s[0],s[1],s[2],s[3],this.x-this.scale,this.y-this.scale,s[0],s[1],s[2],s[3],this.x+this.scale,this.y-this.scale,s[0],s[1],s[2],s[3]];t.set(i,n)}}function tu(e,t){const n=[-1,1,t[0],t[1],t[2],t[3],-1,-1,t[0],t[1],t[2],t[3],1,1,t[0],t[1],t[2],t[3],1,1,t[0],t[1],t[2],t[3],-1,-1,t[0],t[1],t[2],t[3],1,-1,t[0],t[1],t[2],t[3]],s=e.createBuffer({label:"squareMesh",size:n.length*4,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});return new Float32Array(s.getMappedRange()).set(n),s.unmap(),s}function eu(e,t){const n=[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform",hasDynamicOffset:!0,minBindingSize:_e}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform",hasDynamicOffset:!0,minBindingSize:$n}}],s=e.createBindGroupLayout({label:"naiveBindGroupLayout",entries:n}),i=e.createPipelineLayout({label:"naivePipelineLayout",bindGroupLayouts:[s]}),u=e.createShaderModule({label:"naiveShaderModule",code:vi}),C=[{arrayStride:Ae,stepMode:"vertex",attributes:[{format:"float32x2",offset:0,shaderLocation:0},{format:"float32x4",offset:8,shaderLocation:1}]}];return[e.createRenderPipeline({label:"naivePipeline",layout:i,vertex:{module:u,buffers:C},primitive:{topology:"triangle-list"},fragment:{module:u,targets:[{format:t}]}}),s]}function nu(e,t){const n=[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform",hasDynamicOffset:!0,minBindingSize:_e}}],s=e.createBindGroupLayout({label:"instancedBindGroupLayout",entries:n}),i=e.createPipelineLayout({label:"instancedPipelineLayout",bindGroupLayouts:[s]}),u=e.createShaderModule({label:"instancedShaderModule",code:di}),O=[{arrayStride:Ae,stepMode:"vertex",attributes:[{format:"float32x2",offset:0,shaderLocation:0},{format:"float32x4",offset:8,shaderLocation:1}]},{arrayStride:Fe,stepMode:"instance",attributes:[{format:"float32x4",offset:0,shaderLocation:2},{format:"float32x4",offset:16,shaderLocation:3},{format:"float32x4",offset:32,shaderLocation:4},{format:"float32x4",offset:48,shaderLocation:5},{format:"float32x4",offset:64,shaderLocation:6}]}];return[e.createRenderPipeline({label:"instancedPipeline",layout:i,vertex:{module:u,buffers:O},primitive:{topology:"triangle-list"},fragment:{module:u,targets:[{format:t}]}}),s]}function su(e,t){const n=[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform",hasDynamicOffset:!1,minBindingSize:_e}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage",hasDynamicOffset:!1,minBindingSize:0}}],s=e.createBindGroupLayout({label:"instancedSSBOBindGroupLayout",entries:n}),i=e.createPipelineLayout({label:"instancedSSBOPipelineLayout",bindGroupLayouts:[s]}),u=e.createShaderModule({label:"instancedSSBOShaderModule",code:hi}),C=[{arrayStride:Ae,stepMode:"vertex",attributes:[{format:"float32x2",offset:0,shaderLocation:0},{format:"float32x4",offset:8,shaderLocation:1}]}];return[e.createRenderPipeline({label:"instancedSSBOPipeline",layout:i,vertex:{module:u,buffers:C},primitive:{topology:"triangle-list"},fragment:{module:u,targets:[{format:t}]}}),s]}function ru(e){e.stagingArrayBuffer.byteLength!==e.bufferSize&&(e.streamBuffer.destroy(),e.stagingRing.destroy(),e.streamBuffer=e.device.createBuffer({size:e.bufferSize,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX|GPUBufferUsage.UNIFORM}),e.stagingRing=new ir(e.device,e.bufferSize,li),e.stagingArrayBuffer=new ArrayBuffer(e.bufferSize))}function iu(e,t){for(const n of e.squares)n.y-=t*n.speed,n.y<0&&(n.y+=e.surfaceHeight)}function ou(e){if(e.surfaceWidth==0||e.surfaceHeight==0)return;ru(e);let t,n=0,s=0,i,u=e.bufferSize;e.updateMode=="default"?t=new Float32Array(e.stagingArrayBuffer):(e.updateMode=="mapRequired"&&(e.drawMode=="naive"?u=(1+e.squareCount)*Wt:e.drawMode=="batchedVertices"?u=2*Wt+e.squareCount*(6*Ae):e.drawMode=="batchedInstances"||e.drawMode=="batchedInstancesSSBO"?u=Wt+e.squareCount*Fe:ks(),u=Math.max(Wt,mi(u,Wt))),te(u<=e.bufferSize),i=e.stagingRing.next(),i!==void 0&&u<=i.mappingSize?(u==i.mappingSize||console.log("mapping is larger than required"),t=new Float32Array(i.buffer.getMappedRange(0,u))):(console.log(i===void 0?"no staging buffer is available, fall back to writeBuffer()":"mapping is too small, fall back to writeBuffer()"),t=new Float32Array(e.stagingArrayBuffer))),t.set(e.projectionTransform,n/4),n+=Wt;const b=e.device.createCommandEncoder(),C={view:e.canvasContext.getCurrentTexture().createView(),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"},O=b.beginRenderPass({label:"squaresRenderPass",colorAttachments:[C]});let T;if(e.drawMode=="naive"){te(n+e.squareCount*Wt<=e.bufferSize);const L=Ue.create();for(let j=0;j<e.squareCount;j++)e.squares[j].getModelTransform(L),t.set(L,n/4),n+=Wt;T=j=>{j.setPipeline(e.naivePipeline);const rt=e.device.createBindGroup({label:"naiveBindGroup",layout:e.naiveBindGroupLayout,entries:[{binding:0,resource:{buffer:e.streamBuffer,offset:0,size:_e}},{binding:1,resource:{buffer:e.streamBuffer,offset:0,size:$n}}]});let K=Wt;for(let H=0;H<e.squareCount;H++){const ct=e.squares[H],_t=[0,K];j.setBindGroup(0,rt,_t),j.setVertexBuffer(0,e.meshes[ct.meshIndex]),j.draw(6),K+=Wt}}}else if(e.drawMode=="batchedVertices"){te(e.squareCount*6*Ae<=e.bufferSize);const L=Ue.identity();t.set(L,n/4),n+=Wt;for(let j=0;j<e.squareCount;j++)e.squares[j].writeVertices(t,(n+s)/4),s+=6*Ae;T=j=>{j.setPipeline(e.naivePipeline);const rt=e.device.createBindGroup({label:"naiveBindGroup",layout:e.naiveBindGroupLayout,entries:[{binding:0,resource:{buffer:e.streamBuffer,offset:0,size:_e}},{binding:1,resource:{buffer:e.streamBuffer,offset:0,size:$n}}]}),K=[0,Wt];j.setBindGroup(0,rt,K),j.setVertexBuffer(0,e.streamBuffer,n);for(let H=0;H<e.squareCount;H+=e.batchSize){const ct=Math.min(e.batchSize,e.squareCount-H);j.draw(ct*6,1,H*6,0)}}}else if(e.drawMode=="batchedInstances"||e.drawMode=="batchedInstancesSSBO"){te(e.squareCount*Fe<=e.bufferSize);const L=Ue.create();for(let j=0;j<e.squareCount;j++){const rt=e.squares[j];rt.getModelTransform(L);const K=(n+s)/4;t.set(L,K),t.set(_s[rt.meshIndex],K+16),s+=Fe}e.drawMode=="batchedInstances"?T=j=>{j.setPipeline(e.instancedPipeline);const rt=e.device.createBindGroup({label:"instancedBindGroup",layout:e.instancedBindGroupLayout,entries:[{binding:0,resource:{buffer:e.streamBuffer,offset:0,size:_e}}]}),K=[0];j.setBindGroup(0,rt,K),j.setVertexBuffer(0,e.meshes[3]),j.setVertexBuffer(1,e.streamBuffer,n);for(let H=0;H<e.squareCount;H+=e.batchSize){const ct=Math.min(e.batchSize,e.squareCount-H);j.draw(6,ct,0,H)}}:T=j=>{j.setPipeline(e.instancedSSBOPipeline);const rt=e.device.createBindGroup({label:"instancedSSBOBindGroup",layout:e.instancedSSBOBindGroupLayout,entries:[{binding:0,resource:{buffer:e.streamBuffer,offset:0,size:_e}},{binding:1,resource:{buffer:e.streamBuffer,offset:n,size:e.squareCount*Fe}}]});j.setBindGroup(0,rt),j.setVertexBuffer(0,e.meshes[3]);for(let K=0;K<e.squareCount;K+=e.batchSize){const H=Math.min(e.batchSize,e.squareCount-K);j.draw(6,H,0,K)}}}else ks();if(e.uploadSize=n+s,i!==void 0&&i.buffer.unmap(),e.useRenderBundle){if(e.renderBundle==null){const L=e.device.createRenderBundleEncoder({colorFormats:[e.surfaceFormat]});T(L),e.renderBundle=L.finish()}O.executeBundles([e.renderBundle])}else T(O);O.end();const N=e.device.queue;if(t.buffer===e.stagingArrayBuffer)fi(N,e.streamBuffer,e.stagingArrayBuffer,e.uploadSize),N.submit([b.finish()]);else{te(i!==void 0);const L=e.device.createCommandEncoder();L.copyBufferToBuffer(i.buffer,0,e.streamBuffer,0,e.uploadSize),N.submit([L.finish(),b.finish()])}i!==void 0&&e.stagingRing.remap(i,u)}function au(e){const t=new Qc({expanded:!0});t.addBinding(e,"fps",{label:"FPS",readonly:!0,format:i=>Math.round(i).toString()}),t.addBinding(e,"fps",{label:"Frame time (ms)",readonly:!0,format:i=>(1e3/i).toFixed(2)}),t.addBinding(e,"uploadSize",{label:"Upload size (MB)",readonly:!0,format:i=>Math.ceil(i/(1024*1024)).toString()});const n=t.addFolder({title:"Controls"}),s={value:e.bufferSize/(1024*1024)};n.addBinding(s,"value",{label:"Buffer size (MB)",min:Math.ceil(Be*256/(1024*1024)),max:256,step:1}).on("change",i=>{i.last&&(e.bufferSize=s.value*(1024*1024),e.renderBundle=void 0)}),n.addBinding(e,"updateMode",{label:"Update mode",options:{Default:"default","Map (whole buffer)":"map","Map (min size)":"mapRequired"}}),n.addBinding(e,"drawMode",{label:"Draw mode",options:{Naive:"naive","Batched vertices":"batchedVertices","Batched instances":"batchedInstances","Batched instances (SSBO)":"batchedInstancesSSBO"}}).on("change",()=>{e.renderBundle=void 0}),n.addBinding(e,"squareCount",{label:"Squares",min:1,max:Be,step:1}).on("change",()=>{e.renderBundle=void 0}),n.addBinding(e,"batchSize",{label:"Batch size",min:1,max:Be,step:1}).on("change",()=>{e.renderBundle=void 0}),n.addBinding(e,"useRenderBundle",{label:"Use render bundle"}).on("change",()=>{e.renderBundle=void 0})}function lu(e,t){const n=navigator.gpu.getPreferredCanvasFormat();e.configure({device:t,format:n,alphaMode:"opaque"});const s=e.canvas,[i,u]=eu(t,n),[b,C]=nu(t,n),[O,T]=su(t,n),N=Array(Be);for(let K=0;K<Be;K++){const H=50+Math.random()*150,ct=5+Math.random()*5,_t=Math.floor(Math.random()*3);te(_t<3),N[K]=new Jc(0,0,H,ct,_t)}const L={device:t,canvasContext:e,surfaceWidth:0,surfaceHeight:0,surfaceFormat:n,frameCounter:0,fpsAccumulator:0,previousTime:0,meshes:_s.map(K=>tu(t,K)),streamBuffer:t.createBuffer({size:mn,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX|GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE}),stagingRing:new ir(t,mn,li),stagingArrayBuffer:new ArrayBuffer(mn),naivePipeline:i,naiveBindGroupLayout:u,instancedPipeline:b,instancedBindGroupLayout:C,instancedSSBOPipeline:O,instancedSSBOBindGroupLayout:T,renderBundle:void 0,projectionTransform:Ue.create(),squares:N,fps:0,uploadSize:0,bufferSize:mn,updateMode:"mapRequired",drawMode:"batchedInstances",squareCount:Be,batchSize:1,useRenderBundle:!0};au(L);function j(K){const H=Math.floor(L.previousTime/1e3),ct=Math.floor(K/1e3);H!=ct&&0<L.fpsAccumulator&&(L.fps=L.fpsAccumulator,L.fpsAccumulator=0);const _t=L.previousTime==0?0:(K-L.previousTime)/1e3;iu(L,_t),ou(L),L.frameCounter++,L.fpsAccumulator++,L.previousTime=K,requestAnimationFrame(j)}new ResizeObserver(()=>{const K=s.clientWidth,H=s.clientHeight;L.surfaceWidth=s.width=K,L.surfaceHeight=s.height=H,Ue.ortho(0,K,0,H,0,-1,L.projectionTransform);for(const ct of L.squares)ct.x=Math.random()*K,ct.y=Math.random()*H;requestAnimationFrame(j)}).observe(s)}(async()=>{if(navigator.gpu===void 0){const i=document.querySelector("#title");i.innerText="WebGPU is not supported in this browser.";return}const e=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(e===null){const i=document.querySelector("#title");i.innerText="No adapter is available for WebGPU.";return}const t=await e.requestDevice(),n=document.querySelector("#webgpu-canvas");te(n!==null);const s=n.getContext("webgpu");lu(s,t)})();
